<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhaoquaner.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="赵圈儿的博客">
<meta property="og:url" content="https://zhaoquaner.github.io/page/10/index.html">
<meta property="og:site_name" content="赵圈儿的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZhaoXin">
<meta property="article:tag" content="博客">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zhaoquaner.github.io/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>赵圈儿的博客</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">赵圈儿的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">23</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">18</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">169</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhaoXin"
      src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
  <p class="site-author-name" itemprop="name">ZhaoXin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">169</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhaoquaner" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhaoquaner" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zx1522202417@163.com" title="E-Mail → mailto:zx1522202417@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Spring-MVC/3-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Spring-MVC/3-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">3-静态资源访问问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:02:39 / 修改时间：17:00:43" itemprop="dateCreated datePublished" datetime="2022-05-11T14:02:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springmvc/" itemprop="url" rel="index"><span itemprop="name">SpringMVC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>**在之前配置DispatherServlet时，标签<url-pattern>设置的是*.do。当时也写了，可以使用<code>/</code>。**</p>
<p><strong>那么所有请求都默认会给DispatherServlet来进行处理。</strong></p>
<p><strong>如果访问静态资源，DispatherServlet调用处理器映射器来查找相应处理器。当然是找不到的。因为DispatherServlet只能找到哪些使用@RequestMapper注解指定的处理器方法，所以这种情况下，所有的静态资源获取请求都会显示找不到，404错误。</strong></p>
<p>在Tomcat中，有一个专门处理静态资源访问请求的Servlet，叫DefaultServlet。这个Servlet注册在Tomcat的web.xml中，可以在/conf/web.xml文件中找到。</p>
<p>所以当在项目的web.xml文件中使用了<code>/</code>，就会替代tomcat的default。导致所有静态资源都给DispatherServlet处理。默认情况DispatherServlet是没有处理静态资源的能力的。</p>
<h2 id="解决方案">解决方案</h2>
<h3 id="使用">使用<mvn:defalut-servlet-handler /></h3>
<p>在SpringMvc配置文件中声明<mvn:defalut-servlet-handler />标签后，springmvc框架会在容器中创建DefaultServletHttpRequestHandler处理器对象。它会对进入DisPatherServlet的URL进行检查，如果发现是静态资源的请求，就会把该请求转入Web应用服务器默认的Servlet处理。</p>
<h3 id="使用-1">使用<mvn:resources /></h3>
<p>在Spring3.0版本后，Spring定义了专门用于处理静态资源访问请求的处理器ResourceHttpRequestHandler。并且添加了<mvn:resources />标签，来解决静态资源无法访问的情况。</p>
<p>在springmvc配置文件中加上该标签，就会创建ResourceHttpRequestHandler对象。</p>
<p>格式为：</p>
<p><mvc:resources location="" mapping = "" /></p>
<p>其中：</p>
<ul>
<li>location：表示静态资源所在目录，不要使用/WEB-INF目录及其子目录。例如"/images/"，<strong>两个斜杠不能缺，第一个代表根目录，第二个代表images目录下</strong>。</li>
<li>mapper：表示对该资源的请求，一般使用通配符<code>**</code>。例如"/images/**
<strong>"，代表images目录下的所有文件，包括子目录下的。</strong>斜杠同样不能少。**</li>
</ul>
<p>例如：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201217150523209.png" alt="image-20201217150523209" style="zoom:67%;" /></p>
<p><strong>注意：如果加上该标签，但是没有注解驱动标签<mvc:annotation-driven/>，那么动态资源和静态资源会发生冲突，导致动态资源无法访问。所以一定要加上注解驱动标签。</strong></p>
<p><strong>为了更方便一些，不用每类资源写一个标签，可以把所有静态资源放在同一个目录(例如static)中，然后只用一个标签就可以配置所有静态资源。</strong></p>
<h2 id="路径问题">路径问题</h2>
<p><strong>区分一下相对路径前加斜杠<code>/</code>和不加的区别。</strong></p>
<p>在JSP、html、Js文件中使用的地址，都是在前端页面中的地址，是相对地址。</p>
<p>地址有两种：</p>
<ul>
<li>相对地址：没有协议开头的，例如user.some.do，/user/some.do</li>
<li>绝对地址：带有协议开头的，例如http://localhost</li>
</ul>
<p>相对地址不能独立使用，必须要有参考地址，参考地址 + 相对地址
组成完整地址。</p>
<p>举一个例子：</p>
<p>不加斜杠<code>/</code>：</p>
<p>访问资源<code>http://localhost:80/myweb/request.html</code></p>
<p>路径：<code>http://localhost:80/myweb/</code></p>
<p>资源：<code>request.html</code></p>
<p>那么当在request.html中发起user/some.do请求时(就是前端代码
链接是user/some.do)，访问地址会变成<code>http://localhost:80/myweb/user/some.do</code>。所以当在前端点击链接时，访问地址是当前页面的路径加上链接地址。</p>
<p>加上斜杠<code>/</code>：</p>
<p>访问资源<code>http://localhost:80/myweb/request.html</code></p>
<p>路径：<code>http://localhost:80/myweb/</code></p>
<p>资源：<code>request.html</code></p>
<p>而如果前端代码写的链接是/user/some.do，那么点击链接，这时访问地址会变成<code>http://localhost:80/user/some.do</code></p>
<p>那么是不是前端代码全都不加斜杠呢，其实也会出问题。</p>
<p>举一个例子：</p>
<p>后端响应一个页面就是当前页面，例如<code>http://localhost:80/myweb/request.html</code>中点击链接user/some.do，而这个请求响应的也是这个页面request.html，但是这时候地址栏路径就会变为<code>http://localhost:80/myweb/user/some.do</code>，那么响应的页面同样有链接/user/some.do，再次点击，路径就会变为<code>http://localhost:80/myweb/user/user/some.do</code>，这时候就会出现404错误。</p>
<p>处理器方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/user/some.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">doStringData</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;/request.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>html代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>请求页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;user/some.do&quot;</span> &gt;</span>链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/yBRFVxREPx.gif" alt="yBRFVxREPx" style="zoom:67%;" /></p>
所以为了解决这种情况，可以在html页面中
<head>
标签中，加入<base href="">，页面中所有不带<code>/</code>的地址，都会加上base标签指定的路径。支持<a>、<img>、
<form>
<p>等标签中的URL。</p>
<p>例如刚才的例子加上base标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>请求页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost/myweb/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;user/some.do&quot;</span> &gt;</span>链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/ID2LcSj9vw.gif" alt="ID2LcSj9vw" style="zoom:67%;" /></p>
<h3 id="路径使用方法">路径使用方法</h3>
<p>所以总的来说：
前端代码，使用base标签来指定所有不带<code>/</code>的路径，然后链接不带<code>/</code></p>
<p>后端代码，处理器方法注解@RequestMapper中value的值不加斜杠。</p>
<p>如果要返回静态资源，那么就加上/，例如返回一个html文件。<code>return
“/index.html</code>。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Spring-MVC/2-%E5%A4%84%E7%90%86%E5%99%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Spring-MVC/2-%E5%A4%84%E7%90%86%E5%99%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">2-处理器方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:01:39 / 修改时间：17:00:41" itemprop="dateCreated datePublished" datetime="2022-05-11T14:01:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springmvc/" itemprop="url" rel="index"><span itemprop="name">SpringMVC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>已经学了创建控制器类，控制器类里的一个方法对应一个请求或者多个请求。使用@RequestMapping来进行配置。</p>
<p>下面具体来讲一下处理器方法。</p>
<h2 id="requestmapping"><span class="citation"
data-cites="RequestMapping">@RequestMapping</span></h2>
<p><span class="citation"
data-cites="RequestMapping注解可以放在类上面">@RequestMapping注解可以放在类上面</span>，也可以放在方法上。但是含义是完全不一样的。</p>
<h3 id="放在类上面">放在类上面</h3>
<p>放在类上面，其实很简单。只有一种情况，就是当这个类中的所有方法对应的请求都有公共部分时，就可以把该公共部分提取出来放到类上。</p>
<p>表示类中的响应请求的方法都是以该地址作为父路径。</p>
<p>例如MyController类中有doSome()方法和doOther()方法，他们对应的请求分别是<code>/test/some.do</code>和<code>/test/other.do</code>，那么就可以把<code>/test</code>抽取出来，放在类定义上面，也就是<code>@RquestMapper(value="/test")</code>，然后在方法上只使用<code>@RequestMapping(value="/some.do")</code>和<code>@RequestMapping(value="/other.do")</code>即可。代码更简便，同时也便于修改。</p>
<h3 id="放在方法上面">放在方法上面</h3>
<p>之前的例子已经用过了。<span class="citation"
data-cites="RequestMapping注解放在方法上">@RequestMapping注解放在方法上</span>。但只用到了value属性。<span
class="citation"
data-cites="RequestMapping注解还有其他的属性">@RequestMapping注解还有其他的属性</span>。</p>
<p>下面来讲@RequestMapping的属性</p>
<h4 id="value">value</h4>
<p>用来指定请求的实际地址，指定的地址是URI格式。前端代码的请求地址要和这个值保持一致。</p>
<p><strong>注意：只能一个方法对应多个请求，而不能一个请求对应多个方法，那样的话会报错。</strong></p>
<p>前端代码中不能加<code>/</code>。</p>
<h4 id="method">method</h4>
<p>指定请求的方式，例如GET、POST、PUT等</p>
<p>它的值是RequestMethod类的枚举值。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201208131258509.png" alt="image-20201208131258509" style="zoom:35%;" /></p>
<p>例如：<code>@RequestMapping(method=RequestMethod.GET)</code></p>
<p>如果不指定请求方式，那么没有限制，任意一种请求方式都可以。</p>
<h4 id="consumes">consumes</h4>
<p>这个参数指定处理请求的提交内容类型Content-Type，例如application/json，application/html</p>
<p>也是是说，如果这个请求没有包含这个参数指定的提交内容类型，那么就不会处理。</p>
<h4 id="produces">produces</h4>
<p>指定返回的内容类型，只有当请求头中的Accpet的值包含这个参数指定的值，才会处理。</p>
<p>同时其实也暗含了这个方法会返回指定类型的值。</p>
<h4 id="params">params</h4>
<p>指定request中必须包含某些指定参数值，才会让该方法处理。</p>
<p>格式为<code>params="key=value,.."</code>。</p>
<h4 id="headers">headers</h4>
<p>指定request中必须包含某些指定的header值，才让该方法处理请求。</p>
<p>格式为：<code>headers="key=value,.."</code>。</p>
<h2 id="处理器方法参数">处理器方法参数</h2>
<p>处理器方法可以包含以下四类参数，这些参数会在调用时由框架自动赋值，只要在方法形参中定义好，我们可以直接在方法内使用</p>
<ul>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>HttpSession</li>
<li>请求中所携带的请求参数</li>
</ul>
<p>例如想要使用前两个参数，直接在方法签名的形参列表定义即可：<code>public
ModelAndView doSome(HttpServletRequest request, HttpServletResponse
response)</code>。</p>
<h3 id="逐个参数接受">逐个参数接受</h3>
<p>接受请求中所携带的请求参数，可以逐个参数接受。框架会自动进行类型转换。</p>
<p>只需要保证，前端代码的请求参数名和处理方法的参数名相同即可。</p>
<p>例如： 前端代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/some.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> &gt;</span></span><br><span class="line">    姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交信息&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么处理方法中的参数名和前端提交的参数名保持一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">doSome</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    mv.addObject(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    mv.addObject(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line">    mv.setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201208134551362.png" alt="image-20201208134551362" style="zoom:33%;" /></p>
<p>可以看到参数正常接收到了。</p>
<h4 id="post方式解决乱码问题">POST方式解决乱码问题</h4>
<p>当使用POST方式提交值为中文的参数时，会出现乱码。</p>
<p>我们可以使用以往的解决方法，就是调用请求对象request.setCharacterEncoding()，设为UTF-8。但是这样太麻烦，需要重复编写。</p>
<p>可以使用过滤器，来统一设置POST请求的编码方式。</p>
<p>可以自定义过滤器类，也可以使用SpringMVC提供的过滤器类CharacterEncodingFilter类。</p>
<h5 id="在web.xml配置过滤器">在web.xml配置过滤器</h5>
<p>需要在配置文件web.xml中注册过滤器。</p>
<p>该过滤器类有三个成员变量:</p>
<ul>
<li>encoding：字符串类型，指定项目使用的字符编码，一般用utf-8</li>
<li>forceRequestEncoding：布尔类型，指定请求对象request是否使用字符集encoding，默认是false，需要改为true</li>
<li>forceResponseEncoding布尔类型，指定响应对象response是否使用字符集encoding，默认是false，需要改为true</li>
</ul>
<p>同时设置<filter-mapper>中的<url-pattern>值为<code>/*</code>，表示强制所有的请求都必须通过该过滤器。</p>
<p>即：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="requestparam"><span class="citation"
data-cites="RequestParam">@RequestParam</span></h3>
<p>当请求URL的请求参数名和处理方法的形参名不相同时，使用@RequestParam注解放在形参名前，用来指定请求提交的参数名。</p>
<p>该注解有三个属性：</p>
<ul>
<li>value：请求参数名</li>
<li>required：指定该参数是否是必需，默认为true，即请求中必须包含该参数，如果没有，会抛出异常</li>
<li>defaultValue：默认值，如果设置了该值，那么required自动设为false。无论你是否手动配置了required。</li>
</ul>
<p>一般将required设为false。</p>
<p>例子： 修改前端代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;some.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> &gt;</span></span><br><span class="line">    姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myName&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myAage&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交信息&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么方法签名改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">doSome</span><span class="params">(<span class="meta">@RequestParam(&quot;myName&quot;, required = false)</span>String name,</span></span><br><span class="line"><span class="params">                           <span class="meta">@RequestParam(&quot;myAge&quot;, required = false)</span> <span class="type">int</span> age)</span></span><br></pre></td></tr></table></figure>
<h3 id="对象参数接受">对象参数接受</h3>
<p>若把处理器方法的参数定义为一个Java对象，那么只要保证请求的参数名和这个对象的属性名相同即可。</p>
<p>与逐个参数接受差不多。</p>
<p>只不过变成了和Java对象的属性名相同。</p>
<p><strong>适合用于请求参数比较多的情况。</strong></p>
<p><strong>这种方法在实际中应用的比较多。</strong></p>
<p>例如：</p>
<p>前端代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;some.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> &gt;</span></span><br><span class="line">    姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交信息&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建一个类Student</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//set和get方法，构造器方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么在处理器方法中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">doSome</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    mv.addObject(<span class="string">&quot;myStudent&quot;</span>, student);</span><br><span class="line">    mv.setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hello.jsp代码：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;欢迎界面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;欢迎使用SpringMVC开发Web应用&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;姓名是：$&#123;myStudent.name&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;年龄是：$&#123;myStudent.age&#125;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="处理器方法返回值">处理器方法返回值</h2>
<p>常见的返回值有四种类型：</p>
<ul>
<li>ModelAndView</li>
<li>String</li>
<li>void，无返回值</li>
<li>自定义类型的对象</li>
</ul>
<h3 id="modelandview">ModelAndView</h3>
<p>如果处理器方法处理完以后，<strong>需要跳转到其他资源，并且要在跳转的资源间传递数据</strong>，那么处理器方法返回ModelAndView比较好的。</p>
<p>但如果，处理器方法只是进行跳转不传递数据，或者只传递数据并不向任何资源跳转(例如异步请求ajax)，则此时不应该返回ModelAndView。</p>
<h3 id="string">String</h3>
<p>如果处理器方法执行完后，只进行资源跳转。那么可以返回String类型。返回的字符串可以指定逻辑视图名，视图解析器会将其解析，转换为物理视图地址(就是html、jsp等资源文件)。</p>
<p>如果跳转的资源是内部资源，那么因为已经在springmvc.xml文件中注册了视图解析器。所以直接返回方法名即可，视图解析器会将路径前缀和后缀拓展名进行拼接。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">doSome</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发起请求就可以跳转到hello.jsp文件。</p>
<h3 id="void">void</h3>
<p>如果处理器方法不需要跳转到其他资源，可以让处理器方法返回void。</p>
<p>例如对于ajax异步请求的响应。</p>
<h3 id="object">Object</h3>
<p>处理器方法可以返回Object对象，这个对象可以是String、Integer对象，也可以是自定义对象。但是返回的对象不是作为逻辑视图出现的。而是作为直接在页面显示的数据出现的。</p>
<p>返回对象，需要使用@ResponseBody注解，将转换后的JSON数据放入响应体中。<strong>通常是用来响应AJAX请求的。</strong></p>
<h4 id="使用步骤">使用步骤</h4>
<h5 id="导入pom依赖">导入pom依赖</h5>
<p>因为返回Object数据，一般是将数据转换为JSON对象后传递给浏览器页面的。由Object转换为JSON，是由Jackson工具库完成的。需要导入Jackson的相关jar包。</p>
<h5 id="声明注解驱动">声明注解驱动</h5>
<p>将Object数据转换为JSON数据，需要由消息转换器HttpMessageConverter完成。转换器的开启，需要声明注解驱动。</p>
<p>需要在springmvc配置文件中声明注解驱动，加上：<mvc:annotation-driven />。</p>
<p>消息转换器的功能：完成Java对象到json、xml、text和二进制等数据格式的转换。或反过来的转换。</p>
<h6 id="httpmessageconverter">HttpMessageConverter</h6>
<p>HttpMessageConverter是一个接口，负责将请求信息转换为一个对象(类型为T)，将对象(类型为T)输出为响应信息。</p>
<p>定义了Java对象转换为json、xml等数据格式的方法。</p>
<p>该接口中有四个方法：</p>
<ul>
<li><p><code>boolean canRead(Class&lt;?&gt; clazz, MediaType
mediaType)</code>：指定转换器可以读取的对象类型，即转换器是否可以将请求信息转换为clazz类型的对象。同时指定支持MIME类型(text/html,
application/json)。</p>
<p>简单来说，这个
方法是用来检查输入流的数据格式是否可以转换为对应的Java对象</p></li>
<li><p><code>boolean canWrite(Class&lt;?&gt; clazz, MediaType
mediaType)</code>：指定转换器是否可以将clazz类型的对象写入到响应流中，响应流支持的媒体类型在MediaType中定义</p>
<p>简单来说，这个
方法是用来检查处理器方法的返回值是否可以转换为mediaType中的数据格式</p></li>
<li><p><code>T read(Class&lt;?&gt; clazz, HttpInputMessage
inputMessage)</code>：将请求信息流转换为T类型的对象</p></li>
<li><p><code>T write(Class&lt;?&gt; clazz, HttpOutputMessage
outputMessage)</code>：将T类型的对象写入到响应流中，同时指定响应媒体类型为contentType。就是将处理器方法返回的对象转换成指定数据格式。如果是json，就会使用Jackson的工具库来进行转换。</p>
<p>其中MdeiaType用来表示数据格式，例如json、xml等</p></li>
</ul>
<p>这个接口有很多实现类，这些实现类分别完成了Java对象到json、xml等数据格式的转换。</p>
<p><strong>当Spring容器进行初始化时，在读取<mvc:annotation-driven />时，默认会创建七个HttpMessageConverter接口的实现类对象。</strong></p>
<p>这七个实现类对象分别是：</p>
<ul>
<li>ByteArrayHttpMessageConverter：负责读取二进制格式数据和写出二进制格式数据</li>
<li><strong>StringHttpMessageConverter：负责读取字符串格式数据和写出字符串格式数据</strong></li>
<li>ResourceHttpMessageConverter：读取资源文件和写出资源文件数据</li>
<li>SourceHttpMessageConverter：能够读、写来自HTTP请求与相应的javax.xml.transform.Source，支持DOMSource，SAXSource和StreamSource的XML格式</li>
<li>AllEncodingpassingFormHttpMessageConverter：负责处理表单数据</li>
<li>Jaxb2RootElementHttpMessageConverter：使用JAXB负责读取和写入xml格式的数据</li>
<li><strong>MapperJackson2HttpMessageConverter：负责读取和写入json格式的数据。使用Jackson的ObjectMapper读写json数据。操作Object类型数据。可读取application/json，相应媒体类型为application/json</strong></li>
</ul>
<p>其中加粗的两个比较常用。</p>
<h5 id="添加responsebody注解">添加@ResponseBody注解</h5>
<p>将该注解放在对应处理器方法上面。通过HttpServletResponse相应请求，返回数据的。</p>
<p>和其他注解没有顺序先后。</p>
<h4 id="例子">例子</h4>
<h5 id="输出自定义对象">输出自定义对象</h5>
<p>向浏览器返回一个自定义的对象Student，转换为json格式。</p>
<p>处理器方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/returnStudent.do&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Student <span class="title function_">doStudent</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;赵大宝&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">21</span>);</span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>异步请求代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;#btn&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;returnStudent.do&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201217132846957.png" alt="image-20201217132846957" style="zoom:67%;" /></p>
<p>返回对象Json数据的处理流程：</p>
<ul>
<li>框架会将Student类型，调用框架中的ArrayList<HttpMessageConverter>中每个实现类对象的canWrite方法，检查哪个HttpMessageConverter接口的实现类可以处理Student类型的数据，找到MapperJackson2HttpMessageConverter实现类</li>
<li>框架调用实现类的write方法，把student对象转换为json数据，调用Jackson的ObjectMapper</li>
<li>框架调用@ResponseBody把结果输出到浏览器，ajax请求处理完毕。</li>
</ul>
<h5 id="输出list集合">输出List集合</h5>
<p>将List集合转换为JSON对象数组输出。</p>
<p>和上个例子差不多</p>
<p>处理器方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/returnList.do&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">doList</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Student&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;赵大宝&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">21</span>);</span><br><span class="line">    list.add(student);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student1.setName(<span class="string">&quot;李二狗&quot;</span>);</span><br><span class="line">    student1.setAge(<span class="number">22</span>);</span><br><span class="line">    list.add(student1);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;#btn&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;returnList.do&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                $.<span class="title function_">each</span>(data, <span class="keyword">function</span> (<span class="params">i, n</span>)&#123;</span><br><span class="line">                    <span class="title function_">alert</span>(n.<span class="property">name</span> + <span class="string">&quot;  &quot;</span> + n.<span class="property">age</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201217134624351.png" alt="image-20201217134624351" style="zoom:73%;" /></p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201217134613989.png" alt="image-20201217134610237" style="zoom:50%;" /></p>
<h5 id="返回文本数据">返回文本数据</h5>
<p>处理器方法返回的是String类型，这里String表示数据，而不是视图。</p>
<p><strong>区分返回值String是数据还是视图的方法：</strong></p>
<p><strong>如果有注解@ResponseBody，那么就是数据；没有，就是视图</strong></p>
<p>返回String时，默认使用"text/plain;charset=ISO-8859-1"作为contentType，中文会出现乱码。（虽然在web.xml设置了拦截器，强制设置编码方式，但好像对这个没有效果）</p>
<p>解决方案：在@RequestMapping注解中加上属性produces =
"text/plain;charset=utf-8"，来指定新的contentType</p>
<p>处理器方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/returnStringData.do&quot;, produces = &quot;text/plain;charset=utf-8&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">doStringData</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;返回的是文本数据&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;#btn&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;returnStringData.do&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="comment">// dataType:&quot;json&quot;,</span></span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201217141214840.png" alt="image-20201217141214840" style="zoom:50%;" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Spring-MVC/1-Spring-MVC%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Spring-MVC/1-Spring-MVC%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">1-Spring-MVC基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:00:39 / 修改时间：17:00:38" itemprop="dateCreated datePublished" datetime="2022-05-11T14:00:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springmvc/" itemprop="url" rel="index"><span itemprop="name">SpringMVC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概念">概念</h2>
<p>SpringMVC是一个基于Spring的框架，是Spring的一个模块，专门用来作web开发。</p>
<p>web开发的底层是Servlet，框架是在Servlet的基础上加入一些功能，封装一些功能，使得web开发更加方便。</p>
<p>SpringMVC和Spring一样，能够创建对象，并放入到SpringMVC容器中。SpringMVC容器中放的是控制器对象。</p>
<p>SpringMVC中有一个Servlet类：DispatherServlet，<strong>叫中央调度器</strong></p>
<p>​
它负责接受用户的所有请求，用户把请求给DispatherServlet，然后DispatherServlet把请求转发给Controller对象，由Controller对象处理请求。</p>
<p>DispatherServlet主要使用注解来进行开发，使用@Controller创建控制器对象，并把该对象放入SpringMVC容器中。当做一个Servlet对象，<strong>但它不是Servlet，是一个普通类的对象，只是SpringMVC赋予了控制器对象额外的功能。</strong></p>
<h2 id="dispatherservlet">DispatherServlet</h2>
<p>​
DispatherServlet是SpringMVC的一个核心类，叫做中央调度器，或者前端控制器。它把用户的请求转发给Controller对象，并把Controller返回的结果再返回给用户。</p>
<p>​
<strong>同时，DispatherServlet创建的时候，会同时把SpringMVC容器也创建出来，把该容器放入ServletContext中，并读取SpringMVC配置文件中的内容，把Controller对象创建出来。</strong></p>
<p>​ 需要在web.xml文件中注册该对象，格式为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>要加上<load-on-startup>标签，来使该对象在服务器启动时就创建出来，同时创建出SpringMVC容器来。这个标签中应该填一个大于等于0的数，数越小，创建顺序的优先级越高。</p>
<p>其中<url-pattern>的值有两种类型：</p>
<ul>
<li><p>使用拓展名方式，语法是<code>*.xxx</code>，其中xxx是自定义的拓展名，常用的有<code>*.do</code>、<code>*.action</code>、<code>*.mvc</code>等</p>
<p>它表示，凡是以该拓展名结尾的全都交给这个中央调度器处理，例如值时<code>*.do</code>，那么url为http://localhost:80/myweb.some.do请求，以<code>.do</code>结尾，会交给该中央调度器处理</p>
<p>使用斜杠<code>/</code></p></li>
</ul>
<p>在默认情况下，SpringMVC读取Springmvc配置文件的路径为/WEB-INF/<servlet-name>-servlet.xml。</p>
<p>也就是说，上面注册中央调度器的name加上<code>-servlet</code>，例如上面<servlet-name>是springmvc，那么默认读取配置文件路径为<code>WEB-INF/springmvc-servlet.xml</code>。</p>
<p>很不方便，因此<strong>在<servlet>标签内</strong>可以使用<init-param>标签来自定义springmvc配置文件位置，格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;classpath:&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></figure>
<p><param-name>的值固定不变，classpath后加上自定义配置文件路径。</p>
<p>最终格式为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="一个简单的例子">一个简单的例子</h2>
<p>以一个很简单的例子来说明一下SpringMVC是如何使用的。</p>
<p>在前端页面发起一个请求，然后显示欢迎界面。</p>
<h3 id="加入依赖">加入依赖</h3>
<p>在新建的maven项目中加入spring-webmvc依赖，这个依赖同时也包含了spring的核心依赖(不包含spring-jdbc、spring-tx、spring-aspectj依赖)。同时加入servlet和jsp依赖。</p>
<h3
id="在web.xml文件中注册dispatherservlet">在web.xml文件中注册DispatherServlet</h3>
<p>使用前面讲的语法格式来注册中央调度器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建发起请求的页面">创建发起请求的页面</h3>
<p>request.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>请求页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;some.do&quot;</span>&gt;</span>发出一个请求<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建控制器类">创建控制器类</h3>
<p>在controller包中创建一个<strong>普通类</strong>，名字随意。<strong>在类上面加上@Controller注解，表明这是一个控制器对象。</strong></p>
<p>在其中创建一个方法，返回值是ModelAndView，它是Spring-web中的一个类，Model代表数据，View表示页面</p>
<p>没有参数。</p>
<p><strong>在方法上加上注解@RequestMapper，该注解有个value属性，字符串类型，是唯一的，</strong></p>
<p><strong>值是对应请求地址uri，推荐加上<code>/</code>，该注解把一个请求和一个方法映射起来。</strong></p>
<p><strong>也就是当发起这个请求时，DispatherServlet会把该请求转发给这个方法。</strong></p>
<p><strong>若有多个请求地址匹配该方法，则value值可以写上一个数组。</strong></p>
<p>加上注解@RequestMapper的方法叫做<strong>控制器方法</strong>，或者处理器方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">doSome</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        mv.addObject(<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;开心&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;param2&quot;</span>, <span class="string">&quot;快乐&quot;</span>);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;/hello.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建欢迎页面">创建欢迎页面</h3>
<p>在WEB-INF/jsp目录中创建一个欢迎页面hello.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;欢迎页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;h2&gt;欢迎使用SringMVC做Web开发&lt;/h2&gt;</span><br><span class="line">    &lt;h3&gt;$&#123;param1&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;h3&gt;$&#123;param2&#125;/h3&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="创建配置文件">创建配置文件</h3>
<p>在resources目录中，创建springmvc.xml配置文件。和spring配置文件一样，可以直接使用spring配置文件模板。</p>
<p>在其中：</p>
<ul>
<li><p>声明组件扫描器，用来扫描所有的注解，属性base-package指定@Controller注解所在的包名</p></li>
<li><p>声明视图扫描器，用来帮助处理视图。</p>
<p>SpringMVC框架为了避免对于请求资源路径和拓展名的冗余，在视图解析器InternalResourceViewResolver中引入了请求的前缀和后缀，而ModelAndView只需要给出跳转页面的文件名即可。对于具体的文件路径和拓展名，视图解析器会自定完成拼接。</p>
<p>语法格式为：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example.controller&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;文件路径(文件所在目录)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;拓展名，以.开头&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里使用：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example.controller&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>那么在MyController的doSome方法中，<code>mv.setViewName("/WEB-INF/jsp/hello.jsp")</code></p>
<p>改成<code>mv.setViewName("hello")</code>即可。</p></li>
</ul>
<h3 id="注意">注意</h3>
<p>运行时出现了错误，出现了NoSuchMethodError，找不到对应方法。</p>
<p>找了各种各样的解决方法。最后找到了问题。是因为Tomcat版本和pom文件引入的Servlet依赖版本不一致导致的。</p>
<p>我的Tomcat服务器版本是8.5.59，对应的Servlet版本应该是<code>3.1.*</code>，对应jsp版本应该是2.3.*</p>
<p>下图是对应关系：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201208121209461.png" alt="image-20201208121209461" style="zoom:50%;" /></p>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201208121501667.png" alt="image-20201208121501667" style="zoom:50%;" /></p>
<h2 id="springmvc处理请求的流程">SpringMVC处理请求的流程</h2>
<p>以上面的例子，来说明SpringMVC处理请求的流程</p>
<ol type="1">
<li><p>用户发起some.do请求</p></li>
<li><p>tomcat服务器通过配置文件web.xml直到some.do的请求应该给DispatherServlet</p></li>
<li><p>DispatherServlet根据springmvc配置文件springmvc.xml知道要把请求转发给doSome()方法</p></li>
<li><p>doSome方法处理请求，返回ModelAndView对象</p></li>
<li><p>框架把doSome返回的ModelAndView给视图解析器进行处理，视图解析器返回hello.jsp文件</p></li>
</ol>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201208123400687.png" alt="image-20201208123400687" style="zoom:50%;" /></p>
<p>抽象出来，并更加细致的解释SpringMVC处理请求的流程</p>
<ul>
<li><p>浏览器提交请求到中央调度器</p></li>
<li><p>中央调度器直接将请求转给处理器映射器。</p></li>
<li><p>处理器映射器会根据请求，找到处理该请求的处理器，并将其封装为处理器执行链后
返回给中央调度器。</p></li>
<li><p>中央调度器根据处理器执行链中的处理器，找到能够执行该处理器的处理器适配器。</p></li>
<li><p>处理器适配器调用执行处理器。</p></li>
<li><p>处理器将处理结果及要跳转的视图封装到一个对象 ModelAndView
中，并将其返回给 处理器适配器。</p></li>
<li><p>处理器适配器直接将结果返回给中央调度器。</p></li>
<li><p>中央调度器调用视图解析器，将 ModelAndView
中的视图名称封装为视图对象。</p></li>
<li><p>视图解析器将封装了的视图对象返回给中央调度器</p></li>
<li><p>中央调度器调用视图对象，让其自己进行渲染，即进行数据填充，形成响应对象。</p></li>
<li><p>中央调度器响应浏览器。</p></li>
</ul>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201208123559367.png" alt="image-20201208123559367" style="zoom:50%;" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/10-MyBatis-Plus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/10-MyBatis-Plus/" class="post-title-link" itemprop="url">10-MyBatisPlus</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:09 / 修改时间：17:00:22" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:09+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>​</p>
<h2 id="简介">简介</h2>
<p>MyBatis-Plus是MyBatis的增强工具。在MyBatis上，只做增强，不做改变。目的是简化开发，提高效率。</p>
<h3 id="特性">特性</h3>
<ol type="1">
<li>无侵入：就是只做增强，不做改变。不会影响现有工程</li>
<li>损耗小：启动会自动注入基本的CRUD，性能基本无损耗</li>
<li>强大的CRUD操作：内置了通用的Mapper，通用的Service。也有强大的条件构造器</li>
<li>支持Lambda形式调用：使用Lambda表达式编写各类查询条件</li>
<li>支持主键自动生成：支持四种主键策略</li>
<li>内置代码生成器：采用代码或者Maven插件，可以直接生成Mapper、Model、Service、Controlloer代码</li>
<li>内置分页插件</li>
<li>支持多种数据库</li>
<li>内置性能分析插件</li>
<li>内置全局拦截插件</li>
</ol>
<h2 id="一个简单的例子">一个简单的例子</h2>
<ol type="1">
<li>首先创建一张表，或者使用现成的表也可以。</li>
</ol>
<p>使用的表：student
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205113108645.png" alt="image-20210205113108645" style="zoom:67%;" /></p>
<ol start="2" type="1">
<li><p>创建一个SpringBoot项目</p></li>
<li><p>添加mysql依赖，mybatis-plus依赖</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>在<code>application.properties</code>配置mysql</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205113510725.png" alt="image-20210205113510725" style="zoom:50%;" /></p></li>
<li><p>在包entity中创建实体类Student</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注意：</strong></p>
<p><strong>实体类名字一定要和表名一致，大小写不区分。</strong></p>
<p><strong>属性名和表中列名要保持一致，表中列名尽量使用<code>_</code>符号。代表前后是两个单词，MyBatis-Plus会把后面一个单词第一个字母大写，并去掉<code>_</code>例如列名<code>user_name</code>，会对应<code>userName</code>。</strong></p></li>
<li><p>在包dao中创建StudentMapper接口，继承MyBatis-Plus提供的通用Mapper接口<code>BaseMapper&lt;T&gt;</code>，泛型就是对应的实体类。加上注解<code>@Mapper</code>。</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Student&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样就写完了基本的CRUD操作了。这些方法都由<code>BaseMapper</code>写好了。</p></li>
<li><p>测试</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMybatisPlus</span><span class="params">()</span> &#123;</span><br><span class="line">       List&lt;Student&gt; students = studentMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">       students.forEach(System.out::println);</span><br><span class="line">    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>测试结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205113948108.png" alt="image-20210205113948108" style="zoom:67%;" /></p></li>
</ol>
<p>可以看到，使用MyBatis-Plus，代码量很少。不需要写SQL语句，xml文件。</p>
<h2 id="配置日志输出">配置日志输出</h2>
<p>在<code>application.properties</code>配置文件中配置数据库日志输出</p>
<p><code>mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl</code>。</p>
<p>代表标准输出。</p>
<h2 id="主键生成策略">主键生成策略</h2>
<p>当进行插入操作时，如果没有指定主键。但主键又不能为空。所有这时候就需要生成主键。</p>
<h3 id="tableid"><code>@TableId</code></h3>
<p>使用注解<code>@TableId</code>来标记一个表的注解。该注解应放在实体类中对应主键的属性上。</p>
<p>该注解有两个属性：</p>
<ul>
<li>value：字段名，可有可无。默认是空字符串</li>
<li>type：类型</li>
</ul>
<p>需要设置的就是type类型，值是一个枚举类型：</p>
<ul>
<li><code>IdType.AUTO</code>：表示表中主键是自增ID，使用该值，则表的主键必须是自增ID，否则没用</li>
<li><code>IdType.NONE</code>：为设置主键类型，等于跟随全局，约等于INPUT</li>
<li><code>IdType.INOUT</code>：表示需要手动输入，如果没输入，就设为null</li>
<li><code>IdType.ASSIGN_ID</code>：自动分配ID，使用雪花算法(主键类型为number或string)</li>
<li><code>IdType.ASSIGN_UUID</code>：自动分配ID，使用UUID算法</li>
</ul>
<p>如不指定，默认使用<code>IdType.NONE</code>。</p>
<p>还有三种`<code>IdType.ID_WORDKER</code>、<code>IdType.UUID</code>、<code>IdType.ID_WORKER_STR</code>，已经被抛弃不使用了。</p>
<p>前三种无需介绍，详细介绍后两种。</p>
<h3 id="雪花算法">雪花算法</h3>
<p>SnowFlake 算法，是 Twitter 开源的分布式 id
生成算法。其核心思想就是：使用一个 64 bit 的 <strong>long</strong>
型的数字作为全局唯一 id。在分布式系统中的应用十分广泛，且ID
引入了时间戳，基本上保持自增的。</p>
<p>这64位中，分为4部分：</p>
<ol type="1">
<li>占一位：固定是0</li>
<li>占41位：表示时间戳，单位毫秒。存储的是(当前时间戳-开始时间戳)，开始时间戳一般是id生成器开始使用的时间，由程序指定，41位，可以用69年。也就是从开始时间一直用69年，才会用完所有数字</li>
<li>占10位：表示程序所在机器信息。也表示该服务最多可部署在<span
class="math inline">\(2^{10}\)</span>台机器上。其中5个bit代表机房id，5个bit代表机器id</li>
<li>占12位：用来记录同一毫秒产生的不同id，即，如果前面所有都一样，这部分用来区分不同id。占12位，表示一毫秒可生产<span
class="math inline">\(2^{12}\)</span>个不同的id，即4096个id</li>
</ol>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205161158740.png" alt="image-20210205161158740" style="zoom:70%;" /></p>
<h3 id="uuid">UUID</h3>
<p>不过多介绍。</p>
<p>UUID有16个字节，通常以36字节字符串表示。</p>
<p>UUID有多个版本，版本不同，实现的方式不同。</p>
<h2 id="更新操作">更新操作</h2>
<p>​
<code>BaseMapper&lt;T&gt;</code>接口提供了两个更新操作相关方法。</p>
<p><strong><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205165816947.png" alt="image-20210205165816947" style="zoom:80%;" /></strong></p>
<p>第一个方法先不讲。</p>
<p>第二个方法，参数对应实体类对象。</p>
<h3 id="动态sql">动态SQL</h3>
<p>在更新操作时，传入一个实体类对象，MyBatis-Plus会动态拼接SQL语句，当属性值不为空，则更新该属性；当属性值为null，就不会更新。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setId(<span class="number">1013</span>);</span><br><span class="line">    student.setAge(<span class="number">43</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> studentMapper.updateById(student);</span><br><span class="line">    System.out.println(i);</span><br><span class="line">    System.out.println(i == <span class="number">1</span> ? <span class="string">&quot;更新成功&quot;</span>: <span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只设置了主键ID和年龄。日志：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205170259420.png" alt="image-20210205170259420" style="zoom:80%;" /></p>
<p>可以看到，SQL语句只更新了age。</p>
<p>加上<code>student.setEmail("wusong@qq.com")</code></p>
<p>再次执行效果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205170406889.png" alt="image-20210205170406889" style="zoom:67%;" /></p>
<p>可以看到，已经加上了email字段。</p>
<p>所以MyBatis-Plus会动态拼接SQL语句。</p>
<h3 id="自动填充字段">自动填充字段</h3>
<p>有时候，一些字段，不应该手动传值更新，例如创建时间，修改时间。这些应该要自动地进行修改。</p>
<p>MyBatis-Plus提供了这样的功能。</p>
<h4 id="tablefield"><code>TableField</code></h4>
<p>该注解用于非主键的属性。</p>
<p>该注解有以下几个属性：</p>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 21%" />
<col style="width: 42%" />
<col style="width: 17%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th>属性</th>
<th>类型</th>
<th>说明</th>
<th>默认值</th>
<th>必须指定</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>value</code></td>
<td><code>String</code></td>
<td>数据库字段名</td>
<td><code>""</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>el</code></td>
<td><code>String</code></td>
<td>映射为原生<code>#&#123;..&#125;</code>逻辑，<br>相当于xml文件里的<code>#&#123;...&#125;</code>部分</td>
<td><code>""</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>exist</code></td>
<td><code>Boolean</code></td>
<td>是否为数据库表字段</td>
<td><code>true</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>condition</code></td>
<td><code>String</code></td>
<td>字段<code>where</code>实体查询比较的条件<br>有值按设置的值为准，没有则默认全局</td>
<td><code>""</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>update</code></td>
<td><code>String</code></td>
<td>字段<code>update
set</code>部分注入，<br>例如<code>update="%s+1"</code>，表示更新时会<br>set
version = version + 1</td>
<td><code>""</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>insertStrategy</code></td>
<td><code>Enum</code></td>
<td>自动插入字段时的插入策略</td>
<td><code>DEFAULT</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>updateStrategy</code></td>
<td><code>Enum</code></td>
<td>自动更新字段时的更新策略</td>
<td><code>DEFAULT</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>whereStrategy</code></td>
<td><code>Enum</code></td>
<td>测试该字段是否为null或空字符串</td>
<td><code>DEFAULT</code></td>
<td></td>
</tr>
<tr class="odd">
<td><strong><code>fill</code></strong></td>
<td><code>Enum</code></td>
<td>字段自动填充策略</td>
<td><code>FieldFill.DEFAULT</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>select</code></td>
<td><code>boolean</code></td>
<td>是否进行select查询</td>
<td><code>true</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>keepGlobalFormat</code></td>
<td><code>boolean</code></td>
<td>是否保持使用全局format进行处理</td>
<td><code>false</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>jdbcType</code></td>
<td><code>jdbcType</code></td>
<td>JDBC类型</td>
<td><code>jdbcType.UNDEFINED</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>typeHandler</code></td>
<td><code>Class&lt;? extends TypeHandler&gt;</code></td>
<td>类型处理器</td>
<td><code>UnknownTypeHandler.clss</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>numericScale</code></td>
<td><code>String</code></td>
<td>指定小数点后保留位数</td>
<td><code>""</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>其中需要使用的是<code>fill</code>属性。</p>
<p>共有4种值：</p>
<ul>
<li><code>FieldFill.DEFAULT</code>：不处理，默认值</li>
<li><code>FieldFill.INSERT</code>：插入时填充字段</li>
<li><code>FieldFill.UPDATE</code>：更新时填充字段</li>
<li><code>FieldFill.INSERT_UPDATE</code>：插入和更新时填充字段</li>
</ul>
<p>如果只想在添加一行数据时填充指定字段，更新时不再填充，例如<code>create_time</code>创建时间，那么就使用<code>FieldFill.INSERT</code></p>
<p>而想在添加和更新数据时都填充指定字段，使用<code>FieldFill.INSERT_UPDATE</code>。</p>
<p>可以实现<code>MetaObjectHandler</code>接口来实现自定义填充策略。</p>
<p>实现两个方法：</p>
<ul>
<li><code>void insertFill(MetaObject
metaObject)</code>：插入策略，fill属性使用了<code>FieldFill.INSERT</code>或<code>FieldFill.INSERT_UPDATE</code>策略的会调用该方法</li>
<li><code>void updateFill(MetaObject
metaObject)</code>：更新策略，fill属性使用了<code>FieldFill.UPDATE</code>或<code>FieldFill.INSERT_UPDATE</code>策略会调用该方法</li>
</ul>
<p><code>MetaObject</code>代表元数据。</p>
<p>并在两个方法中调用<code>this.setFieldValByName(String fieldName,
Object val, MetaObject metaObject);</code></p>
<p>其中：</p>
<ul>
<li>fieldName：代表属性名称，例如要更新<code>createTime</code>字段，那么这个值就是<code>createTime</code></li>
<li>val：属性值，例如更新<code>createTime</code>字段，那么就可以赋值<code>new
Date()</code></li>
<li>metaObject：传入方法参数的那个metaObject即可</li>
</ul>
<p>注意：</p>
<ul>
<li>填充的原理就是直接给实体类对应属性赋值</li>
<li>MetaObjectHandler提供的默认策略是：如果属性有值则不覆盖，填充值为null则不填充</li>
<li>自定义填充处理器需要加上<code>@Component</code>注解，来交给Spring容器管理</li>
<li>如需要输出日志，则加上注解<code>@Slf4j</code></li>
</ul>
<h4 id="例子">例子</h4>
<p>首先在实体类中添加两个属性，并加上注解<code>@TableField</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br></pre></td></tr></table></figure>
<p>首先创建一个填充处理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;插入填充开始&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        log.info(<span class="string">&quot;插入填充结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;更新填充开始&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        log.info(<span class="string">&quot;更新填充结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进行插入操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setId(<span class="number">1014</span>);</span><br><span class="line">    student.setName(<span class="string">&quot;如来佛祖&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">1000</span>);</span><br><span class="line">    student.setEmail(<span class="string">&quot;rulai@163.com&quot;</span>);</span><br><span class="line">    studentMapper.insert(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：这里并没有写<code>createTime</code>和<code>upateTime</code></p>
<p>运行结果：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205173912472.png"
alt="image-20210205173912472" />
<figcaption aria-hidden="true">image-20210205173912472</figcaption>
</figure>
<p>并且打印出自定义的日志：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205173953002.png"
alt="image-20210205173953002" />
<figcaption aria-hidden="true">image-20210205173953002</figcaption>
</figure>
<p>进行更新操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setId(<span class="number">1014</span>);</span><br><span class="line">    student.setAge(<span class="number">1200</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> studentMapper.updateById(student);</span><br><span class="line">    System.out.println(i);</span><br><span class="line">    System.out.println(i == <span class="number">1</span> ? <span class="string">&quot;更新成功&quot;</span>: <span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205174143487.png"
alt="image-20210205174143487" />
<figcaption aria-hidden="true">image-20210205174143487</figcaption>
</figure>
<p>打印出自定义日志：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210205174202105.png"
alt="image-20210205174202105" />
<figcaption aria-hidden="true">image-20210205174202105</figcaption>
</figure>
<h3 id="乐观锁和悲观锁">乐观锁和悲观锁</h3>
<h4 id="并发控制介绍">并发控制介绍</h4>
<p>并发控制：当程序可能出现并发的情况时，就需要保证在并发状态下数据的准确性，以确保当前用户和其他用户一起操作时，得到的结果和单独操作时的结果是一样的，这种手段就是并发控制。</p>
<p>简单来说：并发控制就是保证一个用户的工作不会对另一个用户的工作产生不合理的影响。</p>
<p>如果没有做好并发控制，就会导致<strong>脏读</strong>、<strong>幻读和不可重复读</strong>等问题。</p>
<p>首先明确：乐观锁和悲观锁，都是定义出来的概念，是一种思想。</p>
<p><strong>乐观锁用于读多写少的场景，悲观锁用于写多读少的情况。</strong></p>
<h4 id="悲观锁">悲观锁</h4>
<p>介绍：</p>
<p>​
当对数据库数据进行修改时，为了避免同时被其他人修改，最好的办法是直接对该数据进行加锁以防止并发。这种借助数据库锁机制，在修改数据之前先锁定，再修改的方式称为悲观并发控制。</p>
<p>​
悲观锁，具有独占和排他特性，之所以叫悲观锁，是因为它总是假设最坏的情况，每次读取数据时都默认其他线程会更改数据。</p>
<p>悲观锁的实现：</p>
<ul>
<li>传统关系型数据库使用这种锁机制，例如行锁，表锁，读锁，写锁等，都是在操作前先上锁</li>
<li>Java中的同步<code>synchronized</code>关键字</li>
</ul>
<p>悲观锁主要分为<strong>共享锁</strong>和<strong>排它锁</strong>：</p>
<ul>
<li>共享锁又称为读锁，简称S锁。共享锁是多个事务对于统一数据可以共享一把锁，都可以访问数据，但不能修改只能读</li>
<li>排它锁称为写锁，简称X锁。排它锁不能与其他锁并存，如果一个事务获取了一个数据的排它锁，那么其他事务就不能再获取该数据的其他锁，包括共享锁和排它锁。获取排它锁的事务可以对数据进行读取和修改</li>
</ul>
<p>说明：</p>
<p>​
悲观并发控制实际是“先取锁再访问”的保守策略，为数据处理安全提供了保证。但是在效率方面，处理加锁的机制会让数据库产生额外开销，也增加了产生死锁的机会，另外会降低并行性。</p>
<p>​</p>
<h4 id="乐观锁optimistic-locking">乐观锁(Optimistic Locking)</h4>
<p>介绍：</p>
<p>​
乐观锁是相对悲观锁而言，乐观锁加上数据一般不会发生冲突，所以在数据进行提交更新时，才会正式对数据的冲突进行检测，如果冲突，则返回错误的信息，让用户决定如何去做。乐观锁适合读操作较多的场景。</p>
<p>乐观锁的实现：</p>
<ul>
<li>CAS实现</li>
<li>版本号控制：也是一会要介绍的。一般是在数据库表或你某个字段加上一个数据版本号version字段，表示数据被修改的次数。当数据被修改时，version值会+
1，当线程A要更新数据值时，读取数据同时也读取version值，在提交更新时，若刚才读取的version和当前数据库version值一致才更新，否则重试更新操作，直到更新成功</li>
</ul>
<h2 id="插件">插件</h2>
<p>MyBatis-Plus提供的插件都需要在配置类中注册组件。</p>
<p>首先创建配置类，并加上<code>@Configuration</code>，并创建一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyBatisPlusInterceptor是MyBatis-Plus提供的拦截器类，在方法中新建一个类，需要什么插件，就创建对应的插件接口实现类，并使用<code>addInnerInterceptor()</code>添加到拦截器中。</p>
<p>可用的插件接口实现类有：</p>
<ul>
<li><code>PaginationInnerInterceptor</code>：自动分页</li>
<li><code>TenanLineInnerInterceptor</code>：多租户</li>
<li><code>DynamicTableNameInnerInterceptor</code>：动态表名</li>
<li><code>OptimisticLockerInnerInterceptor</code>：乐观锁</li>
<li><code>IllegalSQLInnerInterceptor</code>：sql性能规范</li>
<li><code>BlockAttackInnerInterceptor</code>：防止全表更新和删除</li>
</ul>
<p>注：也可以在该配置类中加上注解<code>@MapperScan</code>，不加其实也行，因为DAO接口加上注解<code>@Mapper</code>，不需要扫描。</p>
<h3 id="mybatis-plus实现乐观锁">MyBatis-Plus实现乐观锁</h3>
<p>MyBatis-Plus实现乐观锁非常简单。</p>
<p>在数据库表中加上一个字段<code>version</code>，可以是int类型，并设默认值为1</p>
<p>只要在实体类中添加定义一个属性<code>private Integer
version</code>，并在其上加上注解<code>@Version</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li>支持的数据类型只有：int、Integer、long、Long、Date、Timestamp、LocalDateTime</li>
<li>整数类型下 <code>newVersion = oldVersion + 1</code></li>
<li><code>newVersion</code>会写回到实体类中</li>
<li>只支持<code>updateById()</code>和<code>update(entity,
wrapper)</code>方法</li>
<li>在<code>update(entity, wrapper)</code>方法中，wrapper不能复用</li>
</ul>
<p><strong>特别注意！注意！：只有在更新之前，进行查询操作，才会实现乐观锁，单纯的更新不会实现。</strong></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setId(<span class="number">1014</span>);</span><br><span class="line">    student.setAge(<span class="number">34</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> studentMapper.updateById(student);</span><br><span class="line">    System.out.println(i);</span><br><span class="line">    System.out.println(i == <span class="number">1</span> ? <span class="string">&quot;更新成功&quot;</span>: <span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果这样写，是不会实现乐观锁的。因为获取不到version值。</p>
<p><strong>必须要在更新之前进行查询操作：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentMapper.selectById(<span class="number">1013</span>);</span><br><span class="line">    student.setAge(<span class="number">34</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> studentMapper.updateById(student);</span><br><span class="line">    System.out.println(i);</span><br><span class="line">    System.out.println(i == <span class="number">1</span> ? <span class="string">&quot;更新成功&quot;</span>: <span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样才会实现乐观锁。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210206180311794.png" alt="image-20210206180311794" style="zoom:80%;" /></p>
<h4 id="总结">总结</h4>
<ol type="1">
<li>自定义填充处理类不要忘记加注解<code>@Component</code></li>
<li>实体类属性上记得加注解<code>TableField</code>，并指定<code>fill</code>属性</li>
<li>实现乐观锁，一定要先进行查询操作。气死，TM弄了一天。</li>
</ol>
<h3 id="分页插件">分页插件</h3>
<p>在配置类中添加：<code>interceptor.addInnerInterceptor(new
PaginationInnerInterceptor(DbType.MYSQL));</code></p>
<p>即可注册分页插件，数据库类型是MYSQL。</p>
<p>然后使用Page类或IPage接口都可以。Page类实现了IPage接口。</p>
<p>使用Mapper类的两个方法：</p>
<ul>
<li><code>&lt;E extends IPage&lt;T&gt;&gt; E selectPage(E page,
@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);</code></li>
<li><code>&lt;E extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; E
selectMapsPage(E page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt;
queryWrapper);</code></li>
</ul>
<p>使用上一种方式较多。</p>
<p>使用方法：</p>
<ol type="1">
<li>根据给定参数 当前页码和每页数据量创建Page对象。</li>
<li>在服务层调用mapper对象的上述两个方法</li>
<li>使用Page对象获得查询到的使用</li>
</ol>
<p>例子：</p>
<ol type="1">
<li><p>创建服务层方法：<code>public Page&lt;Categories&gt;
list(Page&lt;Categories&gt; page);</code></p></li>
<li><p>在继承类实现该方法：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;Categories&gt; <span class="title function_">list</span><span class="params">(Page&lt;Categories&gt; page)</span> &#123;</span><br><span class="line">    Page&lt;Categories&gt; categoriesPage = categoriesMapper.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> categoriesPage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>使用传入的参数或返回值(这俩是一个Page对象)来获得查询到的数据和相关数据</p></li>
<li><p>在控制层创建Page对象，并调用服务层方法。</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getCategories</span><span class="params">(Integer pageNumber, Integer limit)</span> &#123;</span><br><span class="line">    Page&lt;Categories&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNumber, limit);</span><br><span class="line">    Page&lt;Categories&gt; list = categoriesService.list(page);</span><br><span class="line">    List&lt;Categories&gt; records = page.getRecords();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p><strong>注意：</strong></p>
<ol type="1">
<li>如果自定义方法实现分页，并调用了mapper的分页方法(就是刚说的两个方法)，<strong>如果返回值是Page对象(和例子一样)，那么传来的参数Page对象不能为空，因为返回值Page对象和参数Page对象就是一个对象。</strong></li>
<li>如果返回值是List集合，那么参数Page对象就可以为空，表示不进行分页。</li>
</ol>
<h2 id="查询操作">查询操作</h2>
<p><code>BaseMapper</code>有几种查询方法：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221130459868.png" alt="image-20210221130459868" style="zoom:67%;" /></p>
<p>挨个介绍：</p>
<ul>
<li><p><code>List&lt;T&gt; selectBatchIds(Collection&lt;? extends
Serializable&gt;)</code>：以Id为查询条件做批量查询，即可同时查询多个Id匹配的行，参数是一个集合，可以是List、Set和Queue，返回值是一个List集合</p>
<p>例子：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Student&gt; students = studentMapper.selectBatchIds(Arrays.asList(<span class="number">1001</span>, <span class="number">1002</span>, <span class="number">1003</span>));</span><br><span class="line">    students.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：</p>
<p>​ <img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221131546875.png"
alt="image-20210221131546875" /></p></li>
<li><p><code>T
selectById(Serializable)</code>：单个查询，返回值是对应实体类</p>
<p>例子：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentMapper.selectById(<span class="number">1001</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221131708309.png" alt="image-20210221131708309" style="zoom:150%;" /></p></li>
<li><p><code>List&lt;T&gt; selectByMap(Map&lt;String,
Object&gt;)</code>：条件查询，使用Map对象，key是String，代表属性名；Object代表属性值。多个key/value对，使用and连接。</p>
<p>例子：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">HashMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;刘备&quot;</span>);</span><br><span class="line">    List&lt;Student&gt; students = studentMapper.selectByMap(map);</span><br><span class="line">    students.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221132145371.png"
alt="image-20210221132145371" />
<figcaption aria-hidden="true">image-20210221132145371</figcaption>
</figure>
<p>例子：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;刘备&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;76&quot;</span>);</span><br><span class="line">    List&lt;Student&gt; students = studentMapper.selectByMap(map);</span><br><span class="line">    students.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221132308173.png"
alt="image-20210221132308173" />
<figcaption aria-hidden="true">image-20210221132308173</figcaption>
</figure></li>
</ul>
<p>后面七个方法都使用了Wrapper条件构造类来设定查询条件。后面再讲。</p>
<h2 id="删除操作">删除操作</h2>
<p>首先来讲一下逻辑删除和物理删除。</p>
<h3 id="逻辑删除">逻辑删除</h3>
<p>逻辑删除的本质就是更新或者修改操作。它并不是真的把数据删除。而是在表中将对应的是否删除标识(如deleted属性或is_delete属性)，做修改操作。例如0是未删除，1是删除。如果该字段修改为1，那么在逻辑上数据是被删除的，但是数据依然存在在数据库中。</p>
<h3 id="物理删除">物理删除</h3>
<p>与之对应的就是物理删除，就是实实在在的删除。数据不会存在在数据库中。</p>
<p>这两种删除的一个应用就是回收站。在将文件加入回收站时，并不会删除，而只是把对应删除标识修改，从回收站恢复该文件，则再修改标识，这是逻辑删除；而清空回收站就是物理删除。</p>
<h3 id="mybatis-plus的删除操作">MyBatis-Plus的删除操作</h3>
<p>几个方法：</p>
<ul>
<li><code>int
delete(Wrapper&lt;T&gt;)</code>：使用Wrapper构造条件删除</li>
<li><code>deleteById(Serializable)</code>：根据主键删除</li>
<li><code>deleteByMap(Map&lt;String,
Object&gt;)</code>：根据Map集合删除</li>
<li><code>deleteBatchIds(Collection&lt;? extends
Serializable&gt;)</code>：根据集合删除</li>
</ul>
<p>用法基本都和查询操作差不多。不多讲。</p>
<p>重点讲一下如何实现逻辑删除。</p>
<h3 id="实现逻辑删除">实现逻辑删除</h3>
<ol type="1">
<li><p>在表中添加deleted字段，类型为boolean或int，默认值是false或0，不为空。</p></li>
<li><p>在配置文件中配置：</p>
<p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="string">0</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>在实体类deleted属性上添加注解<code>@TableLogic</code></p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Boolean deleted;</span><br></pre></td></tr></table></figure></p>
<p>就可以了。</p></li>
</ol>
<p>实现了逻辑删除后，MyBatis-Plus一系列CRUD操作会发生改变：</p>
<ul>
<li>插入操作：不作限制，推荐字段在数据库设置默认值</li>
<li>查询操作：追加where条件来过滤已删除数据，如<code>where deleted =
0</code></li>
<li>更新操作：追加where条件防止更新已删除数据</li>
<li>删除操作：转变为更新操作，即<code>update tablename set deleted = 1
where ...</code></li>
</ul>
<p>字段类型支持说明：</p>
<ul>
<li>支持所有数据类型，推荐使用Integer、Boolean和LocalDateTime</li>
<li>如果数据库字段使用datetime，逻辑未删除值和已删除值支持配置为字段串<code>null</code>，另一个值致辞配置为函数来获取值如<code>now()</code></li>
</ul>
<p>例子：</p>
<p>删除操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> studentMapper.deleteById(<span class="number">1044</span>);</span><br><span class="line">    System.out.println(i);</span><br><span class="line">    System.out.println(i == <span class="number">1</span> ? <span class="string">&quot;删除成功&quot;</span> : <span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221140256573.png"
alt="image-20210221140256573" />
<figcaption aria-hidden="true">image-20210221140256573</figcaption>
</figure>
<p>查询操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Student&gt; students = studentMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    students.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221140352545.png"
alt="image-20210221140352545" />
<figcaption aria-hidden="true">image-20210221140352545</figcaption>
</figure>
<h2 id="条件构造器">条件构造器</h2>
<p>MyBatis-Plus有一个条件构造抽象类Wrapper，它是用来构造复杂的where条件的。</p>
<p>Wrapper有几个子类：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210221141448914.png" alt="image-20210221141448914" style="zoom:80%;" /></p>
<p>主要就分为查询和更新对应Wrapper类。</p>
<h3 id="abstractwrapper">AbstractWrapper</h3>
<p>首先介绍抽象类AbstractWrapper有的方法：</p>
<p>注意：</p>
<ul>
<li>出现的方法中第一个形参condition表示该条件是否加入最后生成的sql中</li>
<li>在形参中出现的R为泛型，在普通wrapper中是String，在LanbdaWrapper中是函数</li>
<li>以下方法出现的<code>R
column</code>均表示数据库字段，而不是实体类数据库字段名。</li>
<li>使用中如果形参的Map或List为空，则不会加入最后生成的sql中</li>
</ul>
<p>为了方便，不会再写含有形参condition的方法。condition形参永远放在第一个参数位置。</p>
<p>方法：</p>
<ul>
<li><p><code>allEq(Map&lt;R, V&gt;
params)</code><br><code>allEq(Map&lt;R, V&gt; params, boolean
null2IsNull)</code><br></p>
<p>说明：</p>
<p>全部相等(或个别isNull)<br><code>params</code>：key为数据库字段名，value为字段值<br><code>null2IsNull</code>：为true则在map的value为空时调用<code>isNull</code>方法，false则忽略vaue为空的字段</p>
<p>示例：</p>
<p><code>allEq(&#123;id:1, name:"Jack", age :null&#125;)</code>--&gt;<code>id = 1
and name = Jack and age is null</code></p>
<p><code>allEq(&#123;id:1, name:"Jack", age :null&#125;,
false)</code>--&gt;<code>id = 1 and name = Jack</code></p></li>
</ul>
<hr />
<pre><code>`between(R column, Object val1, Object val2)`

`notBetween(R column, Object val1, Object val2)`

说明：前两个表示指定字段值在设定两个值之间，闭区间，即`[2,6]`；后两个方法表示不在两个设定值之间，开区间，即($-\infty$, 2) &amp; (6, $+\infty$)

示例：

`between(&quot;age&quot;, 18 ,30)`--&gt;`age between 18 and 30`

`notBetween(&quot;age&quot;, 18 ,30)`--&gt;`age not between 18 and 30`

---</code></pre>
<p>​</p>
<ul>
<li><p><code>like(R column Object val)</code></p>
<p><code>notLike(R column, Object val)</code></p>
<p>说明：Like '%值val%'；NotLike '%值val%'</p>
<p>示例：</p>
<p><code>like("name", 'k')</code>--&gt;<code>name like '%k%'</code></p>
<p><code>notLike("name", 'k')</code>--&gt;<code>name not like
'%k%'</code></p>
<p>根据<code>%</code>位置，还有<code>likeLeft(R column, Object
val)</code>和<code>likeRight(R column, Object val)</code>两个方法。</p>
<p>分别对应<code>%</code>放在左边和右边。</p>
<hr /></li>
<li><p><code>isNull(R column)</code></p>
<p><code>isNotNull(R column)</code></p>
<p>说明：</p>
<ul>
<li>第一个判断字段为空</li>
<li>第二个判断字段不为空</li>
</ul>
<p>示例： <code>isNull("name")</code>--&gt;<code>name is null</code></p>
<p><code>isNotNull("name")</code>--&gt;<code>name is not null</code></p>
<hr /></li>
<li><p><code>is(R column, Collection&lt;?&gt; value)</code></p>
<p><code>is(R column, Object... values)</code></p>
<p><code>notIn(R column, Collection&lt;?&gt; value)</code></p>
<p><code>notIn(R column, Object... values)</code></p>
<p>说明：</p>
<ul>
<li>前两个使用in关键词</li>
<li>后两个使用not in关键词</li>
</ul>
<p>示例：</p>
<p><code>in("age", &#123;1, 2, ,3&#125;)</code>--&gt;<code>age in (1, 2,
3)</code></p>
<p><code>in("age", 1, 2, 3)</code>--&gt;<code>age in (1, 2,
3)</code></p>
<p><code>Notin</code>和<code>in</code>用法一样</p>
<hr /></li>
<li><p><code>nested(Consumer&lt;Param&gt; consumer)</code></p>
<p>表示正常嵌套，只加括号，不带and或or</p>
<p>例如：<code>nested(i-&gt;i.eq("name", 'Jack').ne("status",
1))</code>--&gt;<code>(name = 'Jack' and status = 1)</code></p>
<p><code>apply(String applySql, Object... params)</code></p>
<p>拼接sql</p>
<p>注意：该方法可用于数据库函数动态入参的params对应前面的applySql内部的index部分，这样不会有sql注入风险，反之会有。</p>
<p>例如：<code>apply("id = 1")</code>--&gt;<code>id = 1</code></p>
<p>​ <code>apply("date_format(dataColumn, '%Y-%m-%d') =
'2008-08-08'")</code>--&gt;<code>date_format(dataColumn, '%Y-%m-%d') =
'2008-08-08'</code></p>
<hr /></li>
<li><p><code>eq(R column, Object val)</code></p>
<p>说明：等于=</p>
<p>示例：</p>
<p><code>eq("name"， "赵四")</code>--&gt;<code>name =
'赵四'</code></p></li>
</ul>
<p>与eq类似的还有：</p>
<ul>
<li>ne：not equal，不相等</li>
<li>gt：greater than，大于</li>
<li>ge：greater equal，大于等于</li>
<li>lt：less than，小于</li>
<li>le：小于等于</li>
</ul>
<p>还有一些简单的方法，看名字就知道作用和用法：</p>
<ul>
<li><code>orderByDesc</code></li>
<li><code>orderByAsc</code></li>
<li><code>groupBy</code></li>
<li><code>having</code></li>
<li><code>esists</code></li>
<li><code>notExists</code></li>
</ul>
<p>还有两个方法：</p>
<ul>
<li><code>or()</code></li>
<li><code>and()</code></li>
</ul>
<p>表示使用or或and拼接。</p>
<p>注意：主动调用<code>or</code>表示下一个方法使用or拼接。不调用则默认使用and。</p>
<p><code>or(Consumer&lt;Param&gt; consumer)</code></p>
<p>表示or嵌套。</p>
<p>例如：</p>
<p><code>or(i -&gt; i.eq("name", 'Jack').ne("status",
1))</code>--&gt;<code>or (name = 'Jack' and status &lt;&gt;
1)</code></p>
<h3 id="querywrapper">QueryWrapper</h3>
<p><code>select(String... sqlSelect)</code></p>
<p>用于设置查询字段。</p>
<p>例如：</p>
<p><code>select("id", "name", "age")</code></p>
<h3 id="updatewrapper">UpdateWrapper</h3>
<p>有两个方法：</p>
<ul>
<li><p><code>set(String column, Object val)</code></p>
<p>SQL的set字段</p>
<p>例如<code>set("name", "Jack")</code></p>
<p><code>set("name", "")</code>--&gt;字段值变为空字符串</p>
<p><code>set("name", null)</code>--&gt;字段值变为null</p></li>
<li><p><code>setSql(String sql)</code></p>
<p>直接设置set部分的sql语句</p>
<p>如：<code>setSql("name='Jack'")</code></p></li>
</ul>
<h2 id="代码生成器">代码生成器</h2>
<p>使用代码生成器自动生成代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataAutoGenerator</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建自动生成器对象</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">ag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建全局配置对象</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        <span class="comment">//获取项目绝对路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        <span class="comment">//设置输出目录</span></span><br><span class="line">        gc.setOutputDir(projectPath + <span class="string">&quot;/12-MyBatis_Plus/src/main/java&quot;</span>);</span><br><span class="line">        <span class="comment">//设置作者</span></span><br><span class="line">        gc.setAuthor(<span class="string">&quot;zhao-xin&quot;</span>);</span><br><span class="line">        <span class="comment">//设置生成后不打开输出目录</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//设置Service类命名</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        <span class="comment">//开启 swagger2 模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//添加全局配置到自动生成器</span></span><br><span class="line">        ag.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建数据源对象，并配置数据源。这部分比较熟悉，不细讲了。</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsf.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);</span><br><span class="line">        dsf.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsf.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsf.setPassword(<span class="string">&quot;bigbang2022&quot;</span>);</span><br><span class="line">        dsf.setDbType(DbType.MYSQL);</span><br><span class="line">        ag.setDataSource(dsf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置包</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        <span class="comment">//配置父包，entity等包生成在该包中</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;com.example&quot;</span>);</span><br><span class="line">        <span class="comment">//设置实体类，数据访问层，服务层和控制层的名称</span></span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        <span class="comment">//添加到自动生成器中</span></span><br><span class="line">        ag.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        <span class="comment">//设置命名策略为下划线转驼峰</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">//设置列名命名策略也为下划线转驼峰</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">//是否开启实体类使用lombok</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//使用Rest风格</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置需要生成的表名</span></span><br><span class="line">        strategy.setInclude(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置逻辑删除字段</span></span><br><span class="line">        strategy.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>);</span><br><span class="line">        <span class="comment">//设置乐观锁字段</span></span><br><span class="line">        strategy.setVersionFieldName(<span class="string">&quot;version&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置自动填充字段</span></span><br><span class="line">        List&lt;TableFill&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;create_time&quot;</span>, FieldFill.INSERT));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;update_time&quot;</span>, FieldFill.INSERT_UPDATE));</span><br><span class="line">        strategy.setTableFillList(list);</span><br><span class="line">        <span class="comment">//添加到自动生成器对象</span></span><br><span class="line">        ag.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置模板引擎</span></span><br><span class="line">        ag.setTemplateEngine(<span class="keyword">new</span> <span class="title class_">VelocityTemplateEngine</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//执行</span></span><br><span class="line">        ag.execute();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/9-MyBatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/9-MyBatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" class="post-title-link" itemprop="url">9-MyBatis逆向工程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:08 / 修改时间：17:00:20" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:08+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>MyBatis逆向工程，简单说，就是通过数据库表来自动生成映射文件、DAO接口和实体类。而不需要手动去写。</p>
<p>使用方法：</p>
<ol type="1">
<li>创建GeneratorConfig.xml配置文件</li>
<li>在pom文件中加入mybatis-generator-core依赖，和mybatis-generator的maven插件</li>
<li>编写配置文件</li>
<li>使用插件来生成实体类、mapper文件和Dao接口</li>
</ol>
<p>也可以创建MyBatis-Generator类来代替maven插件生成对应类，但比使用插件麻烦很多。</p>
<h2 id="配置文件">配置文件：</h2>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--指定连接数据库的JDBC 驱动包所在位置，指定到你本机的完整路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">&quot;D:\software\Others\Maven\maven-repository\mysql\mysql-connector-java\8.0.22\mysql-connector-java-8.0.22.jar&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置table表信息内容体，targetRuntime 指定采用MyBatis3的版本--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--抑制生成注释，由于生成的注释都是英文的，可以不让它生成,true为不生成注释--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--配置数据库连接信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test?useSSL=false<span class="symbol">&amp;amp;</span>characterEncoding=utf-8<span class="symbol">&amp;amp;</span>autoReconnect=true&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;数据库密码&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;nullCatalogMeansCurrent&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--生成model 类，targetPackage 指定 model 类的包名，targetProject 指定</span></span><br><span class="line"><span class="comment">        生成的 model放在eclipse的哪个工程下面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.example.demo.model&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">             </span><br><span class="line">        <span class="comment">&lt;!--生成 MyBatis的Mapper.xml文件，targetPackage 指定 mapper.xml文件的包名，targetProject 指定生成的 mapper.xml放在 eclipse的哪个工程下面</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.example.demo.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--生成 MyBatis的 Mapper接口类文件,targetPackage 指定 Mapper 接口类的包名，targetProject 指定生成的 Mapper 接口放在eclipse 的哪个工程下面</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetPackage</span>=<span class="string">&quot;com.example.demo.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--数据库表名及对应的Java模型类名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;student&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Student&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableSelectByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">                       </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                &lt;table tableName=&quot;user&quot; domainObjectName=&quot;User&quot;</span></span><br><span class="line"><span class="comment">                       enableCountByExample=&quot;false&quot;</span></span><br><span class="line"><span class="comment">                       enableUpdateByExample=&quot;false&quot;</span></span><br><span class="line"><span class="comment">                       enableDeleteByExample=&quot;false&quot;</span></span><br><span class="line"><span class="comment">                       enableSelectByExample=&quot;false&quot;</span></span><br><span class="line"><span class="comment">                       selectByExampleQueryId=&quot;false&quot; /&gt;--&gt;</span></span><br><span class="line">                </span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后使用插件自动生成代码。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/8-PageHelper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/8-PageHelper/" class="post-title-link" itemprop="url">8-PageHelper</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:07 / 修改时间：17:00:18" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:07+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>PageHelper插件是一个通用分页插件，它是用来给查询得到的数据分页的。</p>
<p>使用pagehelper的步骤：</p>
<h2 id="加入maven依赖">加入maven依赖</h2>
<p>坐标：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="加入plugin配置配置拦截器">加入plugin配置(配置拦截器)</h2>
<p>在mybatis配置文件中</p>
<p>在<environments>标签之前加入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="调用pagehelper静态方法">调用PageHelper静态方法</h2>
<p>在需要进行分页的MyBatis查询方法之前调用<code>PageHelper.startPage()</code>静态方法即可，紧跟在这个方法后的第一个MyBatis查询方法会被分页。</p>
<p>startPage方法有几个重载形式：</p>
<ul>
<li><code>startPage(int pageNum, int pageSize)</code></li>
<li><code>startPage(int pageNum, int pageSize, boolean
count)</code></li>
<li><code>startPage(int pageNum, int pageSize, String
orderBy)</code></li>
<li><code>startPage(int pageNum, int pageSize, boolean count, Boolean
reasonable, Boolean pageSizeZero)</code></li>
</ul>
<p>参数含义：</p>
<ul>
<li>pageNum：页码，就是要需要显示第几页</li>
<li>pageSize：每页显示数量</li>
<li>count：是否进行count查询</li>
<li>reasonable：分页合理化，null时使用默认配置</li>
<li>pageSizeZero：当为true且pageSize=0时返回全部结果；当为false时分页。null时使用默认配置</li>
</ul>
<p>例子： 要查询数据库中所有的数据</p>
<p>DAO接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; <span class="title function_">selectStudents</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span>&gt;</span></span><br><span class="line">    select * from student</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudents</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    List&lt;Student&gt; list = dao.selectStudents();</span><br><span class="line">    <span class="keyword">for</span>(Student stu:list) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据表：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201204120512650.png" alt="image-20201204120512650" style="zoom:50%;" /></p>
<p>运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201204120544522.png" alt="image-20201204120544522" style="zoom:50%;" /></p>
<p><strong>可以看到，在执行查询前，加上了count操作，用来查询该表有多少行，在查询语句后加上了<code>Limit
?</code>。</strong></p>
<p>除此之外PageHelper还有其他几个方法</p>
<h3 id="offsetpage">offsetPage</h3>
<p>有两种重载形式</p>
<ul>
<li><code>offsetPage(int offset, int limit)</code></li>
<li><code>offsetPage(int offset, int limit, boolean count)</code></li>
</ul>
<p>参数含义：</p>
<ul>
<li>offset：起始位置，也就是从哪行开始数。同时<strong>包括该行。注意：应该按第一行为0的数法。也就是说，如果从第一行开始显示，这个参数应该设为0</strong></li>
<li>limit：每页显示的数量</li>
<li>count：是否进行count查询</li>
</ul>
<p>例子：</p>
<p>接口方法和映射文件不变。</p>
<p>测试代码改为<code>PageHelper.offsetPage(0, 2)</code></p>
<p>运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201204120929472.png" alt="image-20201204120929472" style="zoom:50%;" /></p>
<h3 id="orderby">orderBy</h3>
<p>方法<code>orderBy(String
orderBy)</code>，可以设置查询结果按什么排序，参数orderBy是列名</p>
<h3 id="count">count</h3>
<p>方法<code>long count(ISelect
select)</code>，可以返回任意查询方法的行数。</p>
<p>ISelect是一个接口，只有一个方法<code>void
doSelect()</code>，可以使用匿名内部类实现它，在该方法中调用自己的查询方法。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudents</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> PageHelper.count(<span class="keyword">new</span> <span class="title class_">ISelect</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSelect</span><span class="params">()</span> &#123;</span><br><span class="line">            dao.selectStudents();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(count);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/7-%E5%8A%A8%E6%80%81SQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/7-%E5%8A%A8%E6%80%81SQL/" class="post-title-link" itemprop="url">7-动态SQL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:06 / 修改时间：17:00:16" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:06+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概念">概念</h2>
<p>动态SQL，是指sql的内容是变化的，可以根据不同的条件来获取不同sql语句，主要是where部分发生变化。</p>
<p>使用MyBatis提供的各种标签堆条件做出判断来实现动态拼接Sql语句。常见的动态SQL标签有<if>、<where>、<choose>、<foreach>等。</p>
<p>主要解决的是查询条件不确定的情况，在程序运行期间，根据用户提交的查询条件进行查询。提交的查询条件不同，那么执行的SQL语句也不同，如果将每种情况都列出，会产生大量SQL语句，因此，可使用动态SQL解决这样的问题。</p>
<h2 id="实体符号">实体符号</h2>
<p>在映射文件中的动态SQL中若出现，大于号(&gt;)，小于号(&lt;)，大于等于号(&gt;=)，小于等于号(&lt;=)等符号，应该转换为实体符号，否则XML文件可能解析错误。尤其是小于号(&lt;)。</p>
<p>实体符号表</p>
<table>
<thead>
<tr class="header">
<th>符号</th>
<th>含义</th>
<th>实体符号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;</code></td>
<td>小于</td>
<td><code>&amp;lt;</code>(less than)</td>
</tr>
<tr class="even">
<td><code>&gt;</code></td>
<td>大于</td>
<td><code>&amp;gt;</code>(greater than)</td>
</tr>
<tr class="odd">
<td><code>&gt;=</code></td>
<td>大于等于</td>
<td><code>&amp;gt;=</code></td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>小于等于</td>
<td><code>&amp;lt;=</code></td>
</tr>
</tbody>
</table>
<h2 id="if标签">if标签</h2>
<p>if标签的语法格式为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;使用参数Java对象的属性值作为判断条件，语法：属性=xxx值&quot;</span>&gt;</span></span><br><span class="line">	sql语句</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当if标签中条件成立时，才会拼接if中的sql语句。</p>
<p>简单例子： DAO接口的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; <span class="title function_">selectStudentIf</span><span class="params">(Student student)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select * from student</span><br><span class="line">    where</span><br><span class="line">    <span class="comment">&lt;!--只有当Java对象传来的参数name不为空，且不为空字符串时，才会加入该语句--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27; &quot;</span> &gt;</span></span><br><span class="line">        name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    &lt;！--当age大于零时，拼接下面的sql语句--&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age &gt; 0&quot;</span> &gt;</span></span><br><span class="line">        and age <span class="symbol">&amp;gt;</span> #&#123;age&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudentIf</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;赵四&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">20</span>);</span><br><span class="line">    List&lt;Student&gt; list = dao.selectStudentIf(student);</span><br><span class="line">    <span class="keyword">for</span>(Student stu : list) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以运行成功。</p>
<p>但是有一个问题，当name为空，而年龄不为空时，where语句变成 <code>where
and age &gt; #&#123;age&#125;</code>，这个语句语法是错误的。会报错。</p>
<p>所以为了避免这种情况，需要在where语句中加入一个不影响查询结果和后面if语句的恒为真条件。例如<code>1
= 1</code></p>
<p>那么映射文件中select标签需要改写为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select * from student</span><br><span class="line">    where 1 = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27; &quot;</span> &gt;</span></span><br><span class="line">        and name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age &gt; 0&quot;</span> &gt;</span></span><br><span class="line">        and age <span class="symbol">&amp;gt;</span> #&#123;age&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样，无论在什么条件，sql语句都能够正常执行。<strong>并且注意，加上恒成立条件<code>1
= 1</code>后，第一个if标签中要加上and</strong></p>
<h2 id="where标签">where标签</h2>
<p>if标签比较麻烦的地方就是需要在where后面手动加上<code>1=
1</code>的子句。</p>
<p>而where标签可以实现，在有查询条件时，自动加上where子句；没有查询条件时，不会添加where子句。</p>
<p>语法格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">        and ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">        and ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    ..</span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实就是where标签中嵌套if标签。</p>
<p>需要注意的是：第一个if标签中，可以没有and，也可以写上and，系统会自动把多余and去掉。</p>
<h2 id="foreach标签">foreach标签</h2>
<p><foreach>标签用于实现对数组和集合的遍历。常用在in语句中，in的语法格式为<code>where
列名 in (成员1，成员2，成员3,...)</code></p>
<p>语法格式为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;&quot;</span> <span class="attr">item</span>=<span class="string">&quot;&quot;</span> <span class="attr">open</span>=<span class="string">&quot;&quot;</span> <span class="attr">close</span>=<span class="string">&quot;&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">    #&#123;item的值&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>foreach标签有五个属性：</p>
<ul>
<li>collection：表示要遍历的集合类型，如果是数组，值就是array；如果是List集合，值就是list</li>
<li>item：自定义的变量，代表要遍历的集合变量，相当于<code>for(Student
stu:list)</code>中的stu</li>
<li>open：开始的字符，一般是<code>(</code></li>
<li>close：结束的字符，一般是<code>)</code></li>
<li>separator：集合成员之间的分隔符，一般是<code>,</code></li>
</ul>
<p>有两种常用方式，一种是遍历简单类型，一种是遍历引用类型。</p>
<p>区别就是占位符#{item的值}有所不同。<strong>简单类型<code>#&#123;&#125;</code>里面直接是item定义的值，而引用类型里需要再使用<code>.</code>符号使用引用类型的成员变量。如<code>#&#123;student.id&#125;。</code></strong></p>
<p>使用两种方式的例子：</p>
<h3 id="遍历简单类型">遍历简单类型</h3>
<p>简单类型就是Java的基本数据类型加上String。</p>
<p>例子： DAO接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; <span class="title function_">selectStudentsByIds</span><span class="params">(List&lt;Integer&gt; list)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span>&gt;</span></span><br><span class="line">    select * from student where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudentsByIds</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">1001</span>);</span><br><span class="line">    list.add(<span class="number">1002</span>);</span><br><span class="line">    list.add(<span class="number">1003</span>);</span><br><span class="line">    List&lt;Student&gt; students = dao.selectStudentsByIds(list);</span><br><span class="line">    <span class="keyword">for</span>(Student stu:students) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201204104546520.png" alt="image-20201204104546520" style="zoom:50%;" /></p>
<h3 id="遍历引用类型">遍历引用类型</h3>
<p>DAO接口的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; <span class="title function_">selectStudentsByIds</span><span class="params">(List&lt;Student&gt; list)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span>&gt;</span></span><br><span class="line">    select * from student where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;student&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">        #&#123;student.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudentsByIds</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    List&lt;Student&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student1.setId(<span class="number">1001</span>);</span><br><span class="line">    list.add(student1);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student2.setId(<span class="number">1002</span>);</span><br><span class="line">    list.add(student2);</span><br><span class="line">    List&lt;Student&gt; students = dao.selectStudentsByIds(list);</span><br><span class="line">    <span class="keyword">for</span>(Student stu:students) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201204104945216.png" alt="image-20201204104945216" style="zoom:50%;" /></p>
<h2 id="sql标签">sql标签</h2>
<p><sql>标签用于定义SQL片段，让其他SQL标签复用。</p>
<p>语法格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">	sql语句</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>属性id用来标识该sql语句，是一个唯一值。</p>
<p>使用<include>标签来使用该语句。语法格式为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>属性refid就是需要使用的sql语句的id</p>
<p>例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> &gt;</span></span><br><span class="line">    select * from student</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;select&quot;</span> /&gt;</span></span><br><span class="line">    where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;student&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">        #&#123;student.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/6-%E5%88%AB%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/6-%E5%88%AB%E5%90%8D/" class="post-title-link" itemprop="url">6-别名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:05 / 修改时间：17:00:14" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:05+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="默认别名">默认别名</h2>
<p>MyBatis给Java的常用类型提供了别名：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201203180719481.png" alt="image-20201203180719481" style="zoom:50%;" /></p>
<p>左边是别名，右边是Java数据类型。大部分都是变成小写即可。</p>
<h2 id="自定义别名">自定义别名</h2>
<p>MyBatis同样支持自定义别名来进行开发，主要在resultType属性中使用。</p>
<p>需要在主配置文件中mybatis.xml文件中来定义。</p>
<p>单个类型定义别名的语法格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中type是类型的全限定名称，alias是自定义别名</p>
<p>批量定义别名的语法格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>扫描整个包下的类，别名是类名(首字母小写或大写都可以)，name是包名</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/5-%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/5-%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C/" class="post-title-link" itemprop="url">5-输出结果</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:04 / 修改时间：17:00:12" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:04+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="resulttype">resultType</h2>
<p>该标签表示执行sql语句返回值的类型，使用java类型的全限定名称或者MyBatis定义的别名。但是推荐使用全限定名称。</p>
<p>注意：如果返回的是集合，那么应该设置为集合包含的元素，而不是集合本身。</p>
<p>resultType和resultMap不能同时使用。</p>
<p>MyBatis框架内部会调用对应类的构造方法来创建对象，使用setXXX方法给属性赋值。</p>
<h2 id="map">Map</h2>
<p>Map数据类型可以作为sql查询的返回值，推荐使用Map&lt;Object,
Object&gt;。<strong>但是注意：Map如果作为接口返回值，sql语句的查询结果只能有一条记录，多于一条记录就会出现错误。</strong></p>
<p>其中，列名是Map的key，列值是Map的value。</p>
<p>例子： DAO接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> HashMap&lt;Object, Object&gt; <span class="title function_">selectStudentById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span> &gt;</span></span><br><span class="line">    select id, name, email, age from student where id = #&#123;studentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudentById</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">studentDao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    HashMap&lt;Object, Object&gt; hashMap = studentDao.selectStudentById(<span class="number">1002</span>);</span><br><span class="line">    System.out.println(hashMap);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201203182849126.png" alt="image-20201203182849126" style="zoom:50%;" /></p>
<p>但是如果查询结果超过一条，就会报错。</p>
<h2 id="resultmap">resultMap</h2>
<p>resultMap可以自定义sql的查询结果对应列值和java对象属性的映射关系。更灵活的把列值赋给指定属性。经常用在列名和Java对象属性名不一样的情况。</p>
<h3 id="使用方法">使用方法</h3>
<ol type="1">
<li><p>首先定义resultMap，指定列名和属性的对应关系。</p>
<p>语法格式为：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--主键字段使用id--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--非主键使用result--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>其中resultMap的id属性是自定义的唯一值，在操作数据库标签的resultMap使用，，如<select resultMap="resultMap的id值"></p>
<p>type属性是期望转换成Java对象的全限定名称或别名。</p>
<p>当列为主键使用id标签，非主键使用result字段，column是列名，property是属性名</p></li>
<li><p>在操作数据库如<select>等标签中，把resultType替换成resultMap</p></li>
</ol>
<p>例子： DAO接口定义方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">selectStudents</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudents&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;student&quot;</span> &gt;</span></span><br><span class="line">    select id, name, email, age from student;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudent</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    List&lt;Student&gt; list = dao.selectStudents();</span><br><span class="line">    <span class="keyword">for</span>(Student stu : list) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201203184113423.png" alt="image-20201203184113423" style="zoom:50%;" /></p>
<h2 id="列名和属性名不相同的处理方法">列名和属性名不相同的处理方法</h2>
<ol type="1">
<li><p>第一种方法就是使用之前讲的resultMap标签来定义。</p></li>
<li><p>使用<code>select 列名 as
列别名</code>，将列别名设为和属性名一致。</p>
<p>例如：</p>
<p>定义Java代码：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer stuId;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> String email;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br></pre></td></tr></table></figure></p>
<p>映射文件中：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudents&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id as StuId, name, email, age from student;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p></li>
</ol>
<h2 id="模糊查询">模糊查询</h2>
<p>如果要进行模糊查询，使用Like，有两种方式。跟MyBatis没有关系。就是sql语句，使用"%"进行查询。</p>
<p>一种是是在mapper文件中的sql语句中加入%，另一种就是调用方法传参数时加入"%"。</p>
<p>例子： DAO接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">selectStudentsByName</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByName&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id as StuId, name, email, age from student where name like #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudentByName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">studentDao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    List&lt;Student&gt; list = studentDao.selectStudentsByName(<span class="string">&quot;%赵%&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(Student stu : list) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201203192134193.png" alt="image-20201203192134193" style="zoom:50%;" /></p>
<p>另一种方式就是在测试代码中去掉%，在映射文件中加入%，并使用双引号或者单引号括起来，就是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByName&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id as StuId, name, email, age from student where name like &quot;%&quot; #&#123;name&#125; &quot;%&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/MyBatis/4-%E4%BC%A0%E5%8F%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/blog_images/avatar.png">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/MyBatis/4-%E4%BC%A0%E5%8F%82/" class="post-title-link" itemprop="url">4-传参</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 13:58:03 / 修改时间：17:00:08" itemprop="dateCreated datePublished" datetime="2022-05-11T13:58:03+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/mybatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>从java代码中把数据传入mapper文件的sql语句，</strong>就是传入参数。</p>
<h2 id="parametertype">parameterType</h2>
<p>parameterType是<select>、<insert>等标签的一个属性，用来表示DAO接口中对应方法参数的数据类型。</p>
<p>parameterType的值时java中数据类型的全限定类名或者是mybatis定义的别名。</p>
<p>例如：<code>parameterType =
"java.lang.Integer"</code>、<code>parameterType = "int"</code></p>
<p>注意：parameterType不是必须的，mybatis能够通过反射机制发现接口参数的数据类型，所以可以没有。一般也不写。</p>
<h2 id="传入一个简单类型参数">传入一个简单类型参数</h2>
<p>当DAO接口中的方法只有<strong>一个</strong>简单类型参数时(简单类型就是java的基本数据类型加上String)，那么占位符<code>#&#123;任意字符&#125;</code>获取参数值，括号中的名称和方法参数名无关。可以是任意字符。</p>
<p>例子：</p>
<p>DAO接口中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Student <span class="title function_">selectStudentById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件的内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id, name, email, age from student where id = #&#123;studentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，接口中方法参数名是id，映射文件中是studentId，并不相同。</p>
<h2 id="多个参数-使用param掌握">多个参数-使用@Param(掌握)</h2>
<p>当需要传入多个参数时，可以使用MyBatis提供的@Param注解。</p>
<p>使用方法：</p>
<ul>
<li>DAO接口定义的方法中，在形参定义之前加上@Param("自定义形参数名")</li>
<li>在映射文件中，占位符<code>#&#123;@Param定义的参数名&#125;</code>使用同样的名称来访问该参数</li>
</ul>
<p>非常简单。</p>
<p>例子： 在DAO接口中定义方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">selectStudentsByParams</span><span class="params">(<span class="meta">@Param(&quot;studentName&quot;)</span> String name,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@Param(&quot;studentId&quot;)</span> Integer id)</span>;</span><br></pre></td></tr></table></figure>
<p>在映射文件中编写具体sql语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByParams&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id, name, email, age from student where name = #&#123;studentName&#125; or id = #&#123;studentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到占位符使用的名称和@Param定义的名称相同。</p>
<p>MyBatis推荐使用这种方法。</p>
<h2
id="多个参数-使用java对象属性掌握">多个参数-使用Java对象属性(掌握)</h2>
<p>传入多个参数另一种方法就是传入一个Java对象，该对象的多个属性是数据库实际参数。</p>
<p>使用对象语法：<code>#&#123;属性名，javaType="类型名称",jdbcType="数据类型"&#125;</code></p>
<p>​ 其中：</p>
<p>​ 属性名就是java对象中定义的变量名称；</p>
<p>​ javaType是java中的属性数据类型；</p>
<p>​ jdbcType是在数据库中的数据类型。</p>
<p>但是这样写，非常麻烦。</p>
<p>在实际开发中，一般采用简化模式：<code>#&#123;属性名&#125;</code>，javaType和jdbcType的值MyBatis可以通过反射获取。</p>
<p>这种方法在之前的例子中已经使用过了，在此不再提供例子。</p>
<h2 id="多个参数-使用位置了解">多个参数-使用位置(了解)</h2>
<p>参数位置从0开始，引用参数的语法是：<code>#&#123;arg位置&#125;</code>，例如第一个参数是<code>#&#123;arg0&#125;</code>、第二个是<code>#&#123;arg1&#125;</code>，以此类推。</p>
<p>在MyBatis3.3之前版本使用<code>#&#123;0&#125;</code>、<code>#&#123;1&#125;</code>方式，从3.4使用<code>#&#123;arg0&#125;</code>方式。</p>
<p>例子：</p>
<p>接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">selectStudentsByParams</span><span class="params">(String name, Integer id)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByParams&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id, name, email, age from student where name = #&#123;arg0&#125; or id = #&#123;arg1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="多个参数-使用map了解">多个参数-使用Map(了解)</h2>
<p>Map集合可以存储多个值，使用Map向映射文件一次传入多个参数，Mao集合使用String类型的key，Object类型的值存储value。</p>
<p>mapper文件中使用<code>#&#123;key&#125;</code>来引用对应参数值。</p>
<p>例子： DAO接口中方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">selectStudentsByParams</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentsByParams&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select id, name, email, age from student where name = #&#123;StudentName&#125; or id = #&#123;StudentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectStudentsByParams</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    </span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;StudentName&quot;</span>, <span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;StudentId&quot;</span>, <span class="number">1004</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    List&lt;Student&gt; list = dao.selectStudentsByParams(map);</span><br><span class="line">    <span class="keyword">for</span>(Student stu : list) &#123;</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但这种方法不推荐使用，因为使用Map，不知道传入几个参数，也不知道每个参数的类型。</p>
<h2 id="和-两个占位符比较">#和$-两个占位符比较</h2>
<p>#：占位符，是告诉MyBatis用实际参数值来代替。#{..}代替sql语句中的"?"占位符，更安全，更迅速。</p>
<p>例如： mapper文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span>&gt;</span></span><br><span class="line">    select id, name, email, age from student where id=#&#123;studentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在MyBatis内部执行其实使用的就是JDBC：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id, name, email age from student where id = ?&quot;</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.preparedStatement(sql);</span><br><span class="line">ps.setInt(<span class="number">1</span>, <span class="number">1001</span>);</span><br></pre></td></tr></table></figure>
<p>所以where id = ? 就是 where id= #{studentId}</p>
<p>ps.setInt(1, 1001)，1001会替换#{studentId}</p>
<p>$：这个使用的是字符串拼接的原理。</p>
<p>注意:$是字符串拼接，所以在传入参数时，要使用单引号括起来，例如：</p>
<p><code>List&lt;Student&gt; list = dao.selectStudentsByParams("'李四'",
1004);</code></p>
<p>$是字符串拼接，内部使用Statement来执行sql语句。可能会发生SQL注入，是有风险的。</p>
<p>所以通常，$不用来替换参数值，而是用来替换表名、列名、不同列排序等操作。</p>
<p>例子：使用不同列来进行查询</p>
<p>DAO接口定义方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Student <span class="title function_">findByDiffField</span><span class="params">(<span class="meta">@Param(&quot;col&quot;)</span> String colName, <span class="meta">@Param(&quot;value&quot;)</span> Object value)</span>;</span><br></pre></td></tr></table></figure>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByDiffField&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.domain.Student&quot;</span> &gt;</span></span><br><span class="line">    select * from student where $&#123;col&#125; = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindByDiffField</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">StudentDao</span> <span class="variable">dao</span> <span class="operator">=</span> sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> dao.findByDiffField(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用任何一列来进行查询。</p>
<h3 id="比较两种不同方法">比较两种不同方法</h3>
<p>$它可以替换#。但是原理是完全不同的，#是占位符。在内部使用PreparedStatement来执行sql语句；</p>
<p>使用#的控制台日志：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201202124300046.png"
alt="image-20201202124300046" />
<figcaption aria-hidden="true">image-20201202124300046</figcaption>
</figure>
<p>使用$的控制台日志：</p>
<p>​ <img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20201202124240371.png"
alt="image-20201202124240371" /></p>
<p>可以看出区别，一个是?，一个直接把参数写入到了sql语句。</p>
<p>所以一个是占位符，一个是字符串拼接。</p>
<p>总上，#和$的区别：</p>
<ul>
<li>#使用
？能够在sql语句做占位符，使用PreparedStatement执行sql，效率高</li>
<li>#能够避免sql注入，更安全</li>
<li>$不使用占位符，是字符串连接方法，使用Statement对象执行sql，效率低</li>
<li>$有sql注入的风险，缺乏安全性</li>
<li>$可以替换表名和列名</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhaoXin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
