<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhaoquaner.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="赵圈儿的博客">
<meta property="og:url" content="https://zhaoquaner.github.io/page/8/index.html">
<meta property="og:site_name" content="赵圈儿的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZhaoXin">
<meta property="article:tag" content="博客">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zhaoquaner.github.io/page/8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/8/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>赵圈儿的博客</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">赵圈儿的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">23</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">18</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">169</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZhaoXin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">169</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Redis/6-Java%E4%B8%AD%E4%BD%BF%E7%94%A8Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Redis/6-Java%E4%B8%AD%E4%BD%BF%E7%94%A8Redis/" class="post-title-link" itemprop="url">6-Java中使用Redis</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:25:39 / 修改时间：16:59:57" itemprop="dateCreated datePublished" datetime="2022-05-11T14:25:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在Java中使用Redis。可以使用Redis官方提供的Jedis。和Apache提供的common-pool2。</p>
<p>因为Jedis对象不是线程安全的。所以使用common-pool，对象池来管理Jedis对象。</p>
<p>分别对应两个jar包。</p>
<p>maven坐标为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="简单使用">简单使用</h2>
<p>Jedis的常用的方法名和参数名，基本都和Redis的命令和参数一样。</p>
<p>只演示一下Jedis对象创建、Jedis连接池和事务</p>
<h3 id="创建jedis对象">创建Jedis对象</h3>
<p>Jedis类有多个重载构造器</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102181753031.png" alt="image-20210102181753031" style="zoom: 50%;" /></p>
<p>常用的是<code>Jedis(String host int
port)</code>，参数分别为主机号和端口号。</p>
<h3 id="jedis连接池">Jedis连接池</h3>
<p>创建一个工具类JedisPool，在类中有两个静态方法open、close和一个静态变量JedisPool。</p>
<p>open用来从连接池中获取一个Jedis对象，close负责关闭该链接。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">JedisPool</span> <span class="variable">jedisPool</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title function_">open</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(jedisPool == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//创建Jedis连接池配置对象</span></span><br><span class="line">            <span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">            <span class="comment">//设置最大线程数，一个线程就是一个Jedis实例。默认为8</span></span><br><span class="line">            jedisPoolConfig.setMaxTotal(<span class="number">10</span>);</span><br><span class="line">            <span class="comment">//设置最大空闲实例数，设置这个可以保留足够连接，快速获取到Jedis对象</span></span><br><span class="line">            jedisPoolConfig.setMaxIdle(<span class="number">2</span>);</span><br><span class="line">			<span class="comment">//设置检查项为true，表示从线程池中获取到的Jedis对象一定是可用的</span></span><br><span class="line">            jedisPoolConfig.setTestOnBorrow(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//创建Jedis连接池。参数分别为配置，主机地址和端口。(还可以加上超时连接时间，访问密码)</span></span><br><span class="line">            jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(jedisPoolConfig, host, port);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(jedisPool != <span class="literal">null</span>) &#123;</span><br><span class="line">            jedisPool.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后使Jedis的<code>PoolgetResource()</code>方法来获取Jedis对象，并用try/catch语句块。在finally中关闭jedis对象。等于是将对象放回实例池中，并不是销毁该对象。</p>
<h3 id="事务">事务</h3>
<p>Jedis中有事务Transcation类。</p>
<p>使用<code>Jedis.multi()</code>返回一个事务对象，通过该对象添加操作命令。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102182350395.png" alt="image-20210102182350395" style="zoom:67%;" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Redis/5-Redis%E9%AB%98%E7%BA%A7%E8%AF%9D%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Redis/5-Redis%E9%AB%98%E7%BA%A7%E8%AF%9D%E9%A2%98/" class="post-title-link" itemprop="url">5-Redis高级话题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:24:39 / 修改时间：16:59:55" itemprop="dateCreated datePublished" datetime="2022-05-11T14:24:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="redis事务">Redis事务</h2>
<p>事务是指一系列操作步骤，这些操作步骤，要么全都执行，要么全都不执行。</p>
<p>Redis中的事务是一组命令的集合，至少有两个命令。redis事务保证这些命令被执行时中间不会中断。</p>
<p>Redis事务相关的命令：</p>
<ol type="1">
<li>multi：标记一个事务的开始。事务内的多条命令不会立即执行，而是会按照先后顺序放入一个队列中。总是返回OK</li>
<li>exec：执行所有事务块的内容。可以理解为提交事务。事务被打断返回nil，否则返回OK</li>
<li>discard：取消事务，放弃执行事务块中的所有命令。总是返回OK</li>
<li>watch：语法是：watch key
[key..]，监视一个或多个key，如果在事务执行之前这些key被其他命令改动，那么事务被打断。总是返回OK。</li>
<li>unwatch：取消watch命令对所有key的监视，如果在执行了watch命令后，exec命令或discard命令先被执行了话，就不需要执行unwatch了。总是返回OK</li>
</ol>
<p>举几个例子：</p>
<h3 id="事务正常执行">事务正常执行</h3>
<p>首先使用multi来标志事务开始，即告诉redis要开启一个事务，接下来输入的命令不要执行，先放到一个队列中。</p>
<p>然后使用exec来提交事务。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102123859889.png" alt="image-20210102123859889" style="zoom:67%;" /></p>
<h3 id="事务被放弃">事务被放弃</h3>
<p>如果出现了命令的语法错误或者其他严重错误，导致服务器不能正常工作(例如内存不足)，那么Redis会检测到，并放弃事务。</p>
<p>一般都是语法出现错误，其他错误不常见。</p>
<p>例如使用incr给key对应的value值加1，incr只有一个参数，如果有多个参数，就会有语法错误。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102124525031.png" alt="image-20210102124525031" style="zoom:67%;" /></p>
<p>可以看到，因为之前出现的语法错误，事务已经被放弃。</p>
<h3 id="执行出错不会放弃事务">执行出错，不会放弃事务</h3>
<p>还有一种错误，只有在执行时才能发现，例如使用集合命令去操作字符串，incr命令操作不是数值的value等等。</p>
<p>这一类错误，Redis事务在执行到的时候，会报错，但是不会放弃事务。依然会执行其他事务。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102125059072.png" alt="image-20210102125059072" style="zoom:67%;" /></p>
<p>Redis在遇到这类错误，不会回滚事务，依然正常执行。这样可以保持Redis的高性能。</p>
<h3 id="主动放弃事务">主动放弃事务</h3>
<p>在开启事务后，如果想放弃执行命令，可以使用discard命令放弃事务。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102125432602.png" alt="image-20210102125432602" style="zoom:50%;" /></p>
<h3 id="redis的watch机制">Redis的watch机制</h3>
<p>watch机制原理：</p>
<p>​
使用watch机制监视一个或多个key，如果有key的value值在事务提交之前被修改了，那么整个事务会被取消。执行exec时，会返回提示信息，表示事务已经失败。</p>
<p>​
watch机制，使的事务exec变的有条件，事务只有在watch监视的key对应value没有修改的情况下才会执行。如果使用watch监视了一个带过期时间的键，那么即时这个键过期了，事务仍然可以正常执行。</p>
<p>​
大多数情况下，不同客户端访问不同的键，相互同时竞争同一key的情况很少。</p>
<p>那么何时取消key的监视：</p>
<ol type="1">
<li>watch命令可以调用多次，对键的监视从watch执行后开始生效，一致到调用exec为止，不管事务是否成功执行，对所有键的监视都会被先取消</li>
<li>当客户端断开连接时，该客户端对键的监视也会被取消</li>
<li>unwatch命令可以手动取消对所有键的监视</li>
</ol>
<p>一个例子：</p>
<p>开启两个客户端，在A客户端开启事务，修改str1的值，并监视str1的值，然后在exec执行之前，在B客户端修改str1的值，会看到在A客户端执行提交事务exec后，返回错误信息。</p>
<p>A客户端：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102130604633.png" alt="image-20210102130604633" style="zoom:50%;" /></p>
<p>B客户端：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102130637145.png" alt="image-20210102130637145" style="zoom:50%;" /></p>
<p>A客户端执行exec后：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102130656183.png" alt="image-20210102130656183" style="zoom:50%;" /></p>
<p>返回nil，说明没有成功执行。</p>
<h2 id="持久化">持久化</h2>
<p>持久化可以理解为存储数据，到一个不会丢失的地方。因为如果把数据放在内存中，电脑关闭或者重启就会丢失数据。所以放在内存中的数据不是持久化的，放在磁盘就算是持久化。</p>
<p>Redis提供了两种机制来对数据进行持久化存储。</p>
<h3 id="rdb方式">RDB方式</h3>
<p>Redis
DataBase(RDB)，就是在指定的时间间隔内将内存中的数据集快照(可以理解为数据的情况)写入磁盘，数据恢复时，将快照文件读入内存即可。</p>
<p>RDB保存了在某个时间点的数据集，就是当前时间点的全部数据。存储在一个二进制文件中，默认是dump.rdb。</p>
<p>RDB适合做备份，可以保存最近一个小时，一天的全部数据。保存数据是在单独进程写文件，不影响Redis正常使用，并且RDB恢复数据时，比AOF快。</p>
<h4 id="实现rdb">实现RDB</h4>
<p>使用RDB实现数据持久化，只需要在Redis的配置文件中配置即可。默认配置时启动的。</p>
<p>在配置文件中搜索SNAPSHOTTING。</p>
<p>有三处需要配置：</p>
<ol type="1">
<li><p>配置执行RDB生成快照的时间策略。</p>
<p>配置格式：save seconds changes</p>
<p>意思是，当在seconds秒内，至少有changs个key改动后，那么就保存一次数据集。</p>
<p>例子：save 20 4</p>
<p>意思是，当在二十秒内，有4个及以上的key被改动后，就保存数据集</p></li>
<li><p>dbfilename：设置RDB的文件名，默认dump.rdb</p></li>
<li><p>dir：指定RDB文件存储位置，默认是<code>./</code>当前目录。就是启动redis的工作目录。如果删除dump.rdb文件，然后在windows下的C:/user/username下重新启动redis-server，那么dump文件就会保存到C:/user/username下。</p></li>
</ol>
<p>一个例子： 修改配置文件</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102132454044.png" alt="image-20210102132454044" style="zoom:50%;" /></p>
<p>加上一个<code>save 20 4</code>，如果取消<code>save
""</code>的注释，代表不启用RDB。</p>
<p>其他不修改。</p>
<p>重新开启redis服务端，重新读取配置文件</p>
<h4 id="总结">总结</h4>
<p>RDB优点：存储的是数据快照文件，恢复数据方便。</p>
<p>缺点：</p>
<ul>
<li>会丢失最后一次快照以后更改的数据。如果不能容忍一定数据丢失，使用RDB不是很好</li>
<li>由于需要经常操作磁盘，RDB会分出一个子进程，如果redis数据库很大，子进程会占用较多时间。</li>
</ul>
<h3 id="aof方式">AOF方式</h3>
<p>Append-only
File(AOF)，当Redis每收到一条改变数据的命令时，就把该命令追加写入到AOF文件中(只记录写操作，例如添加key，修改key对应value值，不记录读操作)，当Redis重启时，就读取AOF文件，把存储的所有命令重新执行一遍，来恢复数据。</p>
<h4 id="实现aof">实现AOF</h4>
<p>要在配置文件中配置对应项：</p>
<ol type="1">
<li>appendonly：意思是是否开启AOF持久化，默认是no，改为yes即开启</li>
<li>appendfilename：指定AOF文件名，默认是appendonly,aof</li>
<li>dir:指定AOF存放的目录默认是<code>./</code></li>
<li>appendfsync：配置向AOF文件写命令数据时的策略，有以下可取值：
<ul>
<li>no：不主动进行同步操作，完全交给操作系统来做(每30秒一次)，比较快但是不很安全</li>
<li>always：每次执行写入都会执行同步，慢一些，但是较为安全</li>
<li>everysec：每秒执行一次同步操作，比较平衡。<strong>默认项。</strong></li>
</ul></li>
<li>auto-apf-rewrite-min-size：允许重写的最小AOF文件大小，默认64M，当AOF文件大小64M时，开始整理AOF文件，去掉无用的操作命令，减小aof文件大小。</li>
</ol>
<h4 id="总结-1">总结</h4>
<p>AOF文件在操作过程中会变得越来越大，例如，输入一百次加法计算，最后数据库内存中只会存储最后的结果，但是AOF文件会存储100条记录，99条都对最终记录没用。但是Redis支持在不影响服务前提下，在后台重构AOF文件，让文件变小。</p>
<p>可以同时使用RDB和AOF两种方式，Redis默认优先加载AOF文件，因为aof数据最完整。</p>
<h2 id="主从复制">主从复制</h2>
<p>通过持久化功能，Redis保证了即使服务器重启的情况下也不会丢失数据。但是数据只存储在一台服务器，如果这台服务器出现故障，那么数据同样会丢失。</p>
<p>为了避免单点故障，需要将数据赋值多份部署到不同的服务器上，即使一台服务器出现故障其他服务器依然可以继续提供服务。</p>
<p>这就要求当一台服务器上的数据更新后，自动将更新的数据同步到其他服务器上，通过Redis的主从复制来实现。</p>
<p>Redis提供了复制功能来自动实现多台redis服务器的数据同步，我们不需要关心如何复制，Redis会自动完成。</p>
<p>只要关心哪些服务器是从服务器，哪个是主服务器。</p>
<p>需要在配置文件中来指定多台服务器的主从关系。</p>
<p><strong>主服务器负责写入数据，同时将写入的数据实时同步给从服务器。</strong>主服务器可以读取、写入数据。</p>
<p><strong>从服务器只能读取数据，不能写入数据。</strong></p>
<p>这种模式叫做主从复制，master/slave，主服务器是master，从服务器是slave。</p>
<p>默认master用于写数据，slave用于读数据。在slave中写入数据会出现错误。</p>
<p>Redis主从复制有两种实现方法：</p>
<ul>
<li>修改配置文件，在启动时，服务器读取配置文件，并自动成为指定服务器的从服务器，构成主从复制关系</li>
<li>在启动redis服务时指定当前服务 成为某个主Redis服务器的从服务器。</li>
</ul>
<p>一般常用第一种方式，即修改配置文件。</p>
<p>主服务器不需要修改，在从服务器中加上slaveof，格式为</p>
<p><code>slaveof ip port</code></p>
<p>ip代表主服务器的ip地址，port是redis进程的端口号。</p>
<p>可以使用<code>info
replication</code>来查看redis服务器所处角色，服务器间关系。</p>
<p>不配置文件的话启动默认都是master。</p>
<h3 id="一个例子">一个例子</h3>
<p>在同一电脑模拟三个服务端。其中一个是主服务器，另外两个是从服务器。</p>
<ol type="1">
<li><p>复制三份redis配置文件，名称分别为redis6380.conf，redis6381.conf，redis6382.conf，分别代表三个服务端。</p></li>
<li><p>修改端口号port，分别为6380 6381
6382，其中6380为主服务器端口号。</p></li>
<li><p>再分别修改这三个配置文件的日志文件路径logfile，RDB文件名称dbfilename</p>
<p>​ 如果是linux系统，还需要指定pidfile，表示当前程序的pid文件路径。</p>
<p>​ 如果是linux系统，可以加上<code>daemonize
yes</code>，表示后台启动。</p></li>
<li><p>在两个从服务器的配置文件中加入<code>slaveof 127.0.0.1
6380</code>，表示这两个服务器是ip为127.0.0.1、端口号为6380Redis服务器的从服务器。</p></li>
<li><p>启动三个服务器。</p></li>
</ol>
<p>注意：因为是在一台电脑模拟三台服务器，所以需要修改logfile、dbfilename这些配置。</p>
<p>​ 在实际中，只需要加上slaveof即可。</p>
<p>结果：</p>
<p>运行主服务器：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102152651212.png" alt="image-20210102152651212" style="zoom:47%;" /></p>
<p>运行两台从服务器：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102152718666.png" alt="image-20210102152718666" style="zoom: 33%;" /><img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102152738810.png"
alt="image-20210102152738810" /></p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102152738810.png"
alt="image-20210102152738810" />
<figcaption aria-hidden="true">image-20210102152738810</figcaption>
</figure>
<p>使用redis-cli.exe分别连接到三台服务器。</p>
<p>使用<code>info replication</code>查看服务器关系。</p>
<p>查看主服务器：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102152910164.png" alt="image-20210102152910164" style="zoom:50%;" /></p>
<p>可以看到，角色role是master，即主服务器。连接了两台从服务器，并给出了两台从服务器的ip，port和运行状态state</p>
<p>查看一台从服务器：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102153042651.png" alt="image-20210102153042651" style="zoom:50%;" /></p>
<p>可以看到，角色role是slave，即从服务器。</p>
<p>并给出了它的主服务器的ip，port和运行状态master-link-status：up。代表主服务器在运行，连接成功。</p>
<p>这时，主从服务器中数据都为空。</p>
<p>从服务器中不能写入数据：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102153239758.png" alt="image-20210102153239758" style="zoom:50%;" /></p>
<p>在主服务器中写入两个key：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102153328171.png" alt="image-20210102153328171" style="zoom:50%;" /></p>
<p>然后在从服务器中查看是否已经同步了主服务器的内容。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102153411104.png" alt="image-20210102153411104" style="zoom:50%;" /></p>
<p>可以看到，已经同步成功。</p>
<h3 id="容灾处理">容灾处理</h3>
<p>当主服务器出现故障，不能使用后。需要手动将一台从服务器转为主服务器，即从slave提升为master，然后将其他slave重新挂到新的主服务器上。</p>
<p>在客户端执行命令。</p>
<p>使用的命令有：</p>
<ul>
<li>slaveof no
one：将对应服务器提升为master。(即我不是任何服务器的从服务器)</li>
<li>slaveof ip
port：在其他从服务器上使用，意思是改变该服务器对应的主服务器。</li>
</ul>
<h4 id="例子">例子</h4>
<p>例如例子中的6380出现故障。</p>
<p>需要将6381提升为主服务器，然后6382改变为6381对应服务器的从服务器。</p>
<p>首先停掉6380</p>
<p>然后在6381对应客户端执行命令：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102154244425.png" alt="image-20210102154244425" style="zoom:67%;" /></p>
<p>使用<code>info replication</code>查看服务器连接信息：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102154318331.png" alt="image-20210102154318331" style="zoom:50%;" /></p>
<p>可以看到，已经提升为master，但是它还没有从服务器。</p>
<p>在6382对应客户端，执行改变主服务器命令：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102154427752.png" alt="image-20210102154427752" style="zoom:50%;" /></p>
<p>再次查看6381服务器信息：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102154457580.png" alt="image-20210102154457580" style="zoom:50%;" /></p>
<p>可以看到，已经有了从服务器。</p>
<p>如果出现故障的服务器修好了，需要再次把它加入到服务器集群中。</p>
<p>就应该启动它，然后把它作为现在主服务器的从服务器来使用。</p>
<h3 id="总结-2">总结</h3>
<ul>
<li>一个master可以有多个slave</li>
<li>slave出故障，那么读请求的处理性能下降</li>
<li>master出故障，那么写请求无法执行。</li>
<li>当主服务器出现故障，需要手动指定其中一台slave使用<code>slaveof no
one</code>命令提升为主服务器，其他slave执行slaveof命令指向新的主服务器。</li>
<li>主从复制模式出现故障需要手动处理，如果要实现自动化处理，就要使用Sentinel哨兵，实现故障自动转移。</li>
</ul>
<h2 id="sentinel哨兵">Sentinel哨兵</h2>
<p>Sentinel哨兵是redis官方提供的高可用的方案。用它来监控多个Redis服务实例的运行情况。Sentinel是一个运行在特殊模式下的Redis服务器，Sentinel哨兵是在多个Sentinel进程下互相协作的。</p>
<p>Sentinel系统有三个主要任务：</p>
<ul>
<li>监控：Sentinel不断检查主服务器和从服务器是否按照预期正常工作。</li>
<li>提醒：被监控的Redis出现问题，Sentinel会通知管理员或其他应用程序</li>
<li>自动故障转移：当监控的主服务器不能正常工作，Sentinel会开始进行故障转移操作。将一个从服务器升级为主服务器，并让其他从服务器挂到新的主服务器上，并且为客户端提供新的主服务器地址。</li>
</ul>
<p>每个Sentinel进程，应该独立运行在一台服务器上，多个Sentinel进程之间进行通讯，主要交换监控信息。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102160409308.png" alt="image-20210102160409308" style="zoom:50%;" /></p>
<p>每个Sentinel都监控主服务器，通过主服务器可以监控到从服务器。</p>
<p><strong>注意：至少要运行三个Sentinel进程，也就是至少有三台服务器运行Sentinel。并且运行的Sentinel服务器个数只能为奇数。</strong></p>
<p><strong>这是由Sentinel判断主服务器是否出现故障的机制决定的：每个Sentinel都独立判断主服务器是否出现故障，如果某个Sentinel进程认为主服务器出现故障，那么就投出一票。当投票数超过运行的Sentinel进程数后，那么就认定主服务器出现了故障，进行故障转移操作。也就是少数服从多数，所以至少有三台服务器运行Sentinel进程，且必须为奇数。</strong></p>
<p><strong>注意：Sentinel监控主服务机制：Sentinel会定期向master发送PING命令来确认master是否能够正常运行</strong></p>
<p><strong>注意：无需在sentinel配置文件中指定其他sentinel服务器的信息，因为sentinel可以通过发布和订阅功能来发现正在监视相同主服务器的其他Sentinel，这一功能是通过向频道sentinel:hello发送信息实现的。同样的，也无需列出主服务器属下的所有从服务器，因为Sentinel可以询问主服务器来获取这些信息。每个Sentinel会以两秒一次的频率，通过发布和订阅功能，向被它监视的所有主服务器和从服务器的sentinel:hello发送一条信息，信息中包含了Sentinel的ip地址、端口号和运行ID和完整的主服务器当前配置，当Sentinel通过所有主服务器和从服务器的sentinel:hello频道查找到之前从未出现过的sentinel时，它会将新的Sentinel添加到列表中(就是添加到自己的配置文件中)，关于这些，后面会讲到。</strong></p>
<p><strong>当发现主服务器出现故障并且投票数达到指定的投票数后，Sentinel会从
从服务器中选出一个来作为主服务器，并重新配置：将从服务器设置为主服务器，并将其他的从服务器挂到新的主服务器上。</strong></p>
<p>需要修改Sentinel的配置文件。</p>
<p>修改sentinal monitor这行，格式为：</p>
<p><code>sentinel monitor &lt;name&gt; &lt;masterIp&gt;
&lt;masterPort&gt; &lt;投票数&gt;</code></p>
<p>其中：</p>
<ul>
<li>name：自定义项，表示主服务器，可以理解为给主服务器起个名</li>
<li>masterIp：要监控的主服务器的ip地址</li>
<li>masterPort：要监控的主服务器的端口号</li>
<li>投票数：当投票总数达到多少时，认定主服务器出现故障。例如：有三台运行Sentinel服务器，那么投票数就应该设为2。</li>
</ul>
<p><strong>注意：Windows版本的Redis没有sentinel配置文件，需要手动创建，然后通过redis-server.exe来运行，并加上选项--sentinel，格式为<code>redis-server.exe
&lt;配置文件路径&gt; --sentinel</code></strong>。</p>
<p><strong>如果是linux系统，那么就有redis-sentinel可执行文件和配置文件。</strong></p>
<h3 id="一个例子-1">一个例子</h3>
<p>以上面主从复制例子为基础，在同一台电脑分别运行三个sentinel进程。监控主服务器。</p>
<p>创建sentinel配置文件，分别为sentinel1.conf、sentinel2.conf、sentinel3.conf</p>
<p>添加内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br><span class="line">port 6388</span><br><span class="line">sentinel myid df74029ad5ecbd7677fe8a9e18a97ee086e721c2</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6380 2</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel failover-timeout mymaster 15000</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br></pre></td></tr></table></figure>
<p>其中端口号分别修改为6388、6389、6390。代表三个sentinel进程。</p>
<p>其中：</p>
<ul>
<li>down-after-milliseconds：该选项指定了，当sentinel向主服务器发送请求ping时，多长时间没有有效回复，被认定为主服务器故障。也就是说，发送ping命令后，如果在down-after-milliseconds毫秒内，主服务器没有作出有效回复，那么就被认定为主服务器出现故障。</li>
<li>failover-timeout：表示当故障转移开始后，如果在设定时间内没有执行任务故障转移操作，当前的sentinel会认为这次故障转移失败</li>
<li>parallel-syncs：当发生故障转移，主备切换时，<strong>该选项指定了最多有多少个slave同时对新的master进行数据同步</strong>。当同步数据时，从服务器无法处理命令请求。这个值越小，完成故障转移时间越长，但是读请求性能下降少；值越大，那么意味越多slave因为数据同步replication而不可用。</li>
</ul>
<p>然后启动sentinel：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102170222964.png" alt="image-20210102170222964" style="zoom:67%;" /></p>
<p>可以看到，sentinel运行在sentinel模式下。并且会自动检测到主服务器的所有从服务器。</p>
<p>接下来让主服务器停掉，查看Sentinel进程有什么变化： <img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102172318936.png"
alt="image-20210102172318936" /></p>
<p>另一个sentinel进程：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102172728948.png" alt="image-20210102172728948" style="zoom:50%;" /></p>
<p>可以看到，在主服务器停止工作以后，sentinel监控到了。并打印出日志。</p>
<p>然后从新选出了一个从服务器：端口为6381的服务器，作为主服务器。然后进行重新配置。</p>
<p>查看6381的信息：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102173147500.png" alt="image-20210102173147500" style="zoom:50%;" /></p>
<p>已经变成了主服务器。</p>
<p>这时，如果再重新启动6380服务器，那么该服务器会被sentinel监控到，并被设置为从服务器。</p>
<p>sentinel终端：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102173404158.png" alt="image-20210102173404158" style="zoom:150%;" /></p>
<p>另一个终端：</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102173534732.png"
alt="image-20210102173534732" />
<figcaption aria-hidden="true">image-20210102173534732</figcaption>
</figure>
<p>此时再查看6381信息：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102173428555.png" alt="image-20210102173428555" style="zoom:50%;" /></p>
<p>已经有两个从服务器：6380和6382。</p>
<h3 id="总结-3">总结</h3>
<ol type="1">
<li>Sentinel会不断检查主从服务器是否工作正常</li>
<li>如果Sentinel出现问题，就无法监控。所以需要多个哨兵Sentinel，组成Sentinel网络。一个健康的Sentinel至少有三个Sentinel应用。彼此在不同服务器。(或者不同虚拟机)</li>
<li>监控同一个master的Sentinel会自动连接，组成一个分布式的Sentinel网络，彼此通信并交换被监控服务器和自身信息。</li>
<li>当一个Sentinel认为被监控的服务器下线时，它会向网络中其他Sentinel进行确认，判断服务器是否真的下线。</li>
<li>如果下线的是主服务器，那么Sentinel网络会进行自动故障转移，通过选举从
从服务器slave中选出一个成为新的主服务器，并重新进行配置。</li>
<li>下线的旧主服务器如果重新运行，那么Sentinel会让他成为从服务器。</li>
</ol>
<p><strong>注意：Sentinel监控的不只是主服务器，它监控的是所有服务器，只是当主服务器下线时，它会进行故障转移。</strong></p>
<h2 id="安全设置">安全设置</h2>
<h3 id="设置密码">设置密码</h3>
<p>默认的Redis是没有密码的，这样不太安全。可以通过修改配置文件来设置连接Redis服务端时的密码。</p>
<p>在配置文件中，设置<code>requirepass</code> 这一行。</p>
<p>格式是：<code>requirepass 密码</code></p>
<p>这时，使用客户端连接Redis服务端时，有两种方式：</p>
<ul>
<li>在执行redis-cli时使用-a选项来设置密码，例如：<code>redis-cli -a
123456</code></li>
<li>先执行redis-cli，但是这时不能执行任何redis命令。需要使用<code>auth
密码</code>来验证密码。</li>
</ul>
<h4 id="一个例子-2">一个例子</h4>
<p>设置密码为123456，然后重新运行redis-server，并加载配置文件</p>
<p>使用第一种连接：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102175511144.png" alt="image-20210102175511144" style="zoom:50%;" /></p>
<p>同时也提示，使用-a选项在命令行直接输入密码是不安全的。</p>
<p>使用第二种连接：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102175430833.png" alt="image-20210102175430833" style="zoom:50%;" /></p>
<h3 id="修改绑定ip">修改绑定ip</h3>
<p>在配置文件中，可以修改<code>bind ip</code>这行。</p>
<p>来指定可以访问redis服务器的ip地址。</p>
<p>多个ip使用空格分割。</p>
<h3 id="修改默认端口">修改默认端口</h3>
<p>使用默认的端口比较危险。可以修改。</p>
<p>在配置文件中修改<code>port 端口号</code>即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Redis/4-value%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Redis/4-value%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">4-value数据类型及操作命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:23:39 / 修改时间：16:59:53" itemprop="dateCreated datePublished" datetime="2022-05-11T14:23:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Redis一共有5种数据类型：</p>
<ol type="1">
<li>字符串string：可以存储任何形式的字符串，包括二进制数据，序列化后的数据，JSON化后的数据，甚至是一张图片，最大512M</li>
<li>哈希类型Hash：是一个string类型的field和value的映射表，适合存储对象</li>
<li>列表list：简单的字符串列表，按照插入顺序排序，可以添加一个元素到头部(左边)或者尾部(右边)</li>
<li>集合Set：是String类型的无序集合，集合成员唯一，不能出现重复数据</li>
<li>有序集合zset：和集合set一样是string类型元素的集合，不允许重复成员。并且zset的每个元素会关联一个分数(分数可以重复)，redis按照分数为集合成员进行从小到大排序</li>
</ol>
<h2 id="字符串类型string">字符串类型String</h2>
<p>常用命令：</p>
<h3 id="set">set</h3>
<p>语法：set key value</p>
<p>作用：新建一个key-value键值对，类型都为string</p>
<p>返回值：设置成功，返回OK</p>
<p>注意：如果库中已经有key这个名，那么新value会覆盖旧value</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101140021172.png" alt="image-20210101140021172" style="zoom:67%;" /></p>
<h3 id="setrange">setrange</h3>
<p>语法：setrange key offset value</p>
<p>作用：用value替换key存储的值，从offset开始。如果key不存在，那么就当空白字符串，</p>
<p>返回值：修改后的字符串值长度</p>
<p>索引看作从1开始，那么offset就代表，从第offset后开始替换，不包括offset。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101142514988.png" alt="image-20210101142514988" style="zoom:67%;" /></p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101142506797.png" alt="image-20210101142506797" style="zoom:67%;" /><img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101142645311.png"
alt="image-20210101142645311" /></p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101142506797.png" alt="image-20210101142506797" style="zoom:67%;" /><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101142645311.png" alt="image-20210101142645311" style="zoom:50%;" /></p>
<h3 id="mset">mset</h3>
<p>语法：mset key value [key value ....] 使用空格分隔</p>
<p>作用：同时设置一个或多个key-value</p>
<p>返回值为OK</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101142905033.png" alt="image-20210101142905033" style="zoom:67%;" /></p>
<h3 id="get">get</h3>
<p>语法：get key</p>
<p>作用：获取key对应的value值</p>
<p>返回值：获取成功，返回对应value值，否则返回nil(可以理解为null)</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101140143662.png" alt="image-20210101140143662" style="zoom:67%;" /></p>
<h3 id="getrange">getrange</h3>
<p>语法：getrange key start end</p>
<p>作用：获取key存储字符串值从start到end结束的子字符串。包括start和end。<strong>索引从0开始，负数表示从字符串末尾开始，-1表示最后一个字符</strong></p>
<p>返回值：存在key，就返回指定子字符串；不存在，返回</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101141814824.png" alt="image-20210101141814824" style="zoom:67%;" /></p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101141858495.png" alt="image-20210101141858495" style="zoom:67%;" /></p>
<h3 id="mget">mget</h3>
<p>语法：mget key [key...] 使用空格分隔</p>
<p>作用：获取所有给定的key的字符串值</p>
<p>返回值：包含所有给定key对应的value列表。其中如果key不存在，则返回nil</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101143142094.png" alt="image-20210101143142094" style="zoom:67%;" /></p>
<h3 id="incr">incr</h3>
<p>语法：incr key</p>
<p>作用：将key对应的value的值加1，当value值为数字类型时才可以使用，对非数字操作不行</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101140817603.png" alt="image-20210101140817603" style="zoom:67%;" /></p>
<h3 id="decr">decr</h3>
<p>和incr用法一样，这个是减1</p>
<h3 id="append">append</h3>
<p>语法：append key value</p>
<p>用法：如果key存在，则将value追加到已存在的value后面；如果不存在，那么就创建对应key和value</p>
<p>返回值：返回追加后，字符串总长度</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101141106168.png" alt="image-20210101141106168" style="zoom:80%;" /></p>
<h3 id="strlen">strlen</h3>
<p>语法：strlen key</p>
<p>作用：返回key存储的字符串的长度</p>
<p>返回值：如果key存在， 那么返回字符串值的长度；不存在，返回0</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101141328434.png" alt="image-20210101141328434" style="zoom:80%;" /></p>
<h2 id="哈希类型hash">哈希类型Hash</h2>
<p>常用命令：</p>
<h3 id="hset">hset</h3>
<p>语法：hset key field value</p>
<p>作用：向哈希表key中添加field-value键值对，如果key不存在，则新建hash表，执行赋值；如果存在field，则覆盖旧值</p>
<p>返回值：</p>
<ul>
<li>如果field是hash表中新field，且设置值成功，返回1</li>
<li>如果field已经存在，旧值覆盖新值，返回0</li>
</ul>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101143825536.png" alt="image-20210101143825536" style="zoom:67%;" /></p>
<h3 id="hget">hget</h3>
<p>语法：hget key field</p>
<p>作用：获取哈希表key中给定域的值</p>
<p>返回值：如果key不存在或者field不存在返回nil，否则返回field对应的值</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101144022748.png" alt="image-20210101144022748" style="zoom:67%;" /></p>
<h3 id="hmset">hmset</h3>
<p>语法：hmset key field value [field value...]</p>
<p>作用：同时将多个field-value键值对添加到哈希表key中，此命令会覆盖已存在的field。如果key不存在，那么创建空的hash表，再执行hmset</p>
<p>返回值：成功返回OK，失败返回错误</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101144247754.png" alt="image-20210101144247754" style="zoom:67%;" /></p>
<h3 id="hmget">hmget</h3>
<p>语法：hmget key field [field...]</p>
<p>作用：获取哈希表key中多个给定field对应的值</p>
<p>返回值：返回和field顺序对应的值，如果field不存在，返回nil</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101144415762.png" alt="image-20210101144415762" style="zoom:50%;" /></p>
<h3 id="hgetall">hgetall</h3>
<p>语法：hgetall key</p>
<p>作用：获取哈希表key中所有的域和值</p>
<p>返回值：以列表形式返回哈希表中域和值，key不存在，返回空hash</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101144618780.png" alt="image-20210101144618780" style="zoom:67%;" /></p>
<h3 id="hdel">hdel</h3>
<p>语法：hdel key field [field...]</p>
<p>作用：删除哈希表key中一个或多个指定field及其值。如果不存在field，则忽略</p>
<p>返回值：返回删除成功的field的数量</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101144801626.png" alt="image-20210101144801626" style="zoom:67%;" /></p>
<h3 id="hkeys">hkeys</h3>
<p>语法：hkeys key</p>
<p>作用：查看哈希表key中所有的field</p>
<p>返回值：包含所有field的列表，key不存在返回空列表</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101145107819.png" alt="image-20210101145107819" style="zoom: 50%;" /><img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101145125043.png"
alt="image-20210101145125043" /></p>
<h3 id="hvals">hvals</h3>
<p>语法：hvals key</p>
<p>作用：返回哈希表中所有域对应的值</p>
<p>返回值：值的列表，key不存在，返回空列表</p>
<figure>
<img
src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101145125043.png"
alt="image-20210101145125043" />
<figcaption aria-hidden="true">image-20210101145125043</figcaption>
</figure>
<h3 id="hexists">hexists</h3>
<p>语法：hexists key field</p>
<p>作用：查看哈希表key中，指定的field是否存在值</p>
<p>返回值：存在返回1，不存在返回0</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101145150434.png" alt="image-20210101145150434" style="zoom:67%;" /></p>
<h2 id="列表类型list">列表类型List</h2>
<p>简单的字符串列表，也就是value只能是字符串。可以添加一个元素到列表的表头(左边)或者表尾(右边)</p>
<p>常用命令：</p>
<h3 id="lpush">lpush</h3>
<p>语法：lpush key value [value..]</p>
<p>作用：将一个或多个值插入列表key的表头(左边)，从左边开始加入值，按从左到右顺序依次加入到表头。<strong>如果不存在key，那么会创建一个list，并加入给定value。也就是说，如果给定key存在，那么列表至少有一个value。</strong></p>
<p>返回值：一个数字，新列表的长度</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101145717927.png" alt="image-20210101145717927" style="zoom:67%;" /></p>
<p>在列表中顺序依次为c b a</p>
<h3 id="lpushx">lpushx</h3>
<p>和lpush用法一样，只是当key不存在时，该命令不会创建list</p>
<h3 id="rpush">rpush</h3>
<p>语法：rpush key value [value..]</p>
<p>作用：将一个或多个值插入列表key的表尾(右边)，从左边开始加入值，按从左到右顺序依次加入到表尾。<strong>如果不存在key，那么会创建一个list，并加入给定value。也就是说，如果给定key存在，那么列表至少有一个value。</strong></p>
<p>返回值：一个数字，新列表的长度</p>
<p><code>rpush list a b c</code>，那么在列表中顺序为a b c</p>
<h3 id="rpushx">rpushx</h3>
<p>和rpush用法一样，只是当key不存在时，该命令不会创建list</p>
<h3 id="lrange">lrange</h3>
<p>语法：lrange key start stop</p>
<p>作用：获取列表key中指定区间的元素。索引从0开始。包括start和stop</p>
<p>也可以为负数，-1为列表最后一个元素，-2为倒数第二个元素，以此类推。start、stop超出列表范围不会出现错误。</p>
<p>返回值：指定区间的列表</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101150156030.png" alt="image-20210101150156030" style="zoom:67%;" /></p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101150210479.png" alt="image-20210101150210479" style="zoom:67%;" /></p>
<h3 id="lindex">lindex</h3>
<p>语法：lindex key index</p>
<p>作用：获取列表key中下标为index的元素。索引从0开始。也可以是负数，-1代表最后一个元素。</p>
<p>返回值：存在，则返回指定元素；index不再列表范围，返回nil</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101150644676.png" alt="image-20210101150644676" style="zoom:67%;" /></p>
<h3 id="llen">llen</h3>
<p>语法：llen key</p>
<p>作用：获取列表key的长度</p>
<p>返回值：数值，列表长度；不存在key则返回0</p>
<h3 id="lrem">lrem</h3>
<p>语法：lrem key count value</p>
<p>作用：根据参数count的值，移除列表中和参数value相等的元素，count&gt;0；则从列表左侧开始向右移除count个相等的元素；count&lt;0，则从列表右侧开始移除
count绝对值 个相等的元素；count=0，则移除所有和value相等的值</p>
<p>返回值：移除的元素个数</p>
<h3 id="lset">lset</h3>
<p>语法：lset key index value</p>
<p>作用：将列表key下标为index的元素的值设置为value</p>
<p>返回值：成功返回OK；key不存在或者index超出范围返回错误信息</p>
<h3 id="linsert">linsert</h3>
<p>语法：linsert key BEFORE|AFTER pivot value</p>
<p>作用：将值value插入到列表key中位于值pivot之前或之后的位置。key不存在或pivot不在列表，则不执行任何操作</p>
<p>返回值：执行成功，返回新列表长度；没有找到pivot返回-1；key不存在返回0</p>
<p>注意：pivot是值value，不是索引。</p>
<h3 id="lpop">lpop</h3>
<p>语法：lpop key</p>
<p>作用：删除并获取列表key中第一个元素(最左边表头元素)</p>
<p>返回值：列表不存在，返回nil；否则返回对应元素值</p>
<h3 id="rpop">rpop</h3>
<p>语法：rpop key</p>
<p>作用：删除并获取列表key中最后一个元素(最右边表尾元素)</p>
<p>返回值：列表不存在，返回nil；否则返回对应元素值</p>
<h3 id="blpop">blpop</h3>
<p>语法：blpop key [key..] timeout</p>
<p>作用：删除并获取列表key中第一个元素(最左边表头元素)，如果列表没有元素会阻塞到超时。超时时间timeout单位为秒</p>
<p>返回值：列表不存在，返回nil；否则返回一个含有两个元素的列表，第一个元素是列表的key，第二个元素是被删除的value</p>
<h3 id="brpop">brpop</h3>
<p>语法：brpop key [key..] timeout</p>
<p>作用：删除并获取列表key中最后一个元素(最右边表尾元素)，如果列表没有元素会阻塞到超时。超时时间timeout单位为秒</p>
<p>返回值：列表不存在，返回nil；否则返回一个含有两个元素的列表，第一个元素是列表的key，第二个元素是被删除的value</p>
<h2 id="集合类型set">集合类型Set</h2>
<p>Set是字符串类型的无序集合，元素不能重复</p>
<p>常用命令有：</p>
<h3 id="sadd">sadd</h3>
<p>语法：sadd key member [member...]</p>
<p>作用：将一个或多个元素加入到集合key中；如果有member已经在集合中，则会被忽略，不会加入</p>
<p>返回值：加入到集合的新元素的个数，不包括被忽略的元素</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102113140552.png" alt="image-20210102113140552" style="zoom:67%;" /></p>
<h3 id="smembers">smembers</h3>
<p>语法：smembers key</p>
<p>作用：获取集合key中所有的成员元素，不存在的key被视为空集合</p>
<p>返回值：成员元素列表</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102113244013.png" alt="image-20210102113244013" style="zoom:67%;" /></p>
<h3 id="sismember">sismember</h3>
<p>语法：sismember key member</p>
<p>作用：判断member元素是否是集合key的成员</p>
<p>返回值：是返回1，不是返回0</p>
<h3 id="scard">scard</h3>
<p>语法：scrad key</p>
<p>作用：获取集合中元素个数</p>
<p>返回值：一个数字</p>
<h3 id="srem">srem</h3>
<p>语法：srem key member [member...]</p>
<p>作用：删除集合key中一个或多个元素，不存在的元素会被忽略</p>
<p>返回值：数字，成功删除的元素个数，不包括忽略的元素</p>
<h3 id="srandmember">srandmember</h3>
<p>语法：srandmember key [count]</p>
<p>作用：如果只提供key参数，那么会随机返回集合一个元素，元素不删除；如果提供了count，count是正数，那么返回包含了count个元素的集合，集合元素各不相同；如果是负数，返回一个count绝对值的长度的集合，集合中元素可能会重复多次</p>
<p>返回值：多个元素的集合</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102114027892.png" alt="image-20210102114027892" style="zoom:67%;" /></p>
<h3 id="spop">spop</h3>
<p>语法：spop key [count]</p>
<p>作用：随机从集合中删除并获取一个元素，count是删除元素的个数。不指定count，默认删除一个。</p>
<p>返回值：被删除的元素；如果key不存在或者空集合返回nil</p>
<h3 id="sinter">sinter</h3>
<p>语法：sinter key1 [key2...]</p>
<p>作用：返回给定所有元素的交集。如果只给一个集合参数，就返回该集合所有元素</p>
<p>返回值：一个交集合。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102114459556.png" alt="image-20210102114459556" style="zoom:67%;" /></p>
<h3 id="sinterstore">sinterstore</h3>
<p>语法：sinter destination key1 [key2]</p>
<p>作用：返回给定所有集合的交集元素个数并存储到destination中</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102114733237.png" alt="image-20210102114733237" style="zoom:67%;" /></p>
<h3 id="sunion">sunion</h3>
<p>语法：sunion key1 [key2]</p>
<p>作用：返回给定所有集合的并集元素，如果只给一个集合参数，就返回该集合所有元素。</p>
<p>返回值：一个集合</p>
<h3 id="sunionstore">sunionstore</h3>
<p>语法：sunionstore destination key1 [key2]</p>
<p>作用：返回给定所有集合的并集元素个数并存储到destination中</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102114931584.png" alt="image-20210102114931584" style="zoom:50%;" /></p>
<h2 id="有序集合类型zset">有序集合类型zSet</h2>
<p>有序集合zset和集合类型set都是string类型的集合。且不允许重复。</p>
<p>不同的是，zset每个元素都会关联一个分数，分数可以重复，分数可以是整数或浮点数</p>
<p>redis通过分数来为集合成员进行从小到大的排序。</p>
<p>常用命令有：</p>
<h3 id="zadd">zadd</h3>
<p>语法：zadd key score member [score member...]</p>
<p>作用：将一个或多个member元素及其score值加入到有序集合key中，如果mmember存在集合中，则更新score值。</p>
<p>返回值：新添加的元素个数，不包括已存在的member</p>
<h3 id="zrange">zrange</h3>
<p>语法：zrange ket start stop [WITHSCORES]</p>
<p>作用：查询有序集合指定区间的元素。集合成员按score值从小到大来排序。索引从0开始。-1表示最后一个成员。如果加上WITHSCORES选项，表示让score和value一起返回</p>
<p>返回值：自定区间的成员集合</p>
<h3 id="zrevrange">zrevrange</h3>
<p>语法：zrevrange ket start stop [WITHSCORES]</p>
<p>作用：查询有序集合指定区间的元素。集合成员按score值从大到小来排序。索引从0开始。-1表示最后一个成员。如果加上WITHSCORES选项，表示让score和value一起返回</p>
<p>返回值：自定区间的成员集合</p>
<p>和zrange命令基本一样。zrange从小到大排列，zrevrange从大到小排列</p>
<h3 id="zrem">zrem</h3>
<p>语法：zrem key member [member...]</p>
<p>作用：删除有序集合key中的一个元素或多个，不存在的成员会被忽略</p>
<p>返回值：被成功刹车农户的成员数量。不包括被忽略的成员</p>
<h3 id="zcard">zcard</h3>
<p>语法：zcard key</p>
<p>作用：获取有序集key元素个数</p>
<p>返回值：元素个数；key不存在，返回0</p>
<h3 id="zrangebyscore">zrangebyscore</h3>
<p>语法：zrangebyscore key min max [WITHSCORES] [LIMIT offset count]</p>
<p>作用：获取有序集key中，所有socre介于min和max之间(包括min和max)的成员，有序集合按递增(从小到大)排序</p>
<p>​ 使用符号<code>(</code>表示不包括min和max，也就是开区间；</p>
<p>​ 使用-inf和+inf分别表示，最小和最大；</p>
<p>​
<strong>LIMIT用来限制返回结果的数量和区间。表示在符合条件的成员中，从第offset个位置(索引从0开始)开始，取count个元素。</strong></p>
<p>​ WITHSCORES表示一起显示score和value</p>
<p>返回值：指定区间的集合数据</p>
<p>使用的数据：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102120807849.png" alt="image-20210102120807849" style="zoom:50%;" /></p>
<p>第一个例子：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102120849877.png" alt="image-20210102120849877" style="zoom:50%;" /></p>
<p>使用<code>(</code>代表开区间：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102120937482.png" alt="image-20210102120937482" style="zoom:50%;" /></p>
<p>使用-inf和+inf表示最小和最大：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102121032936.png" alt="image-20210102121032936" style="zoom:50%;" /></p>
<p>使用limit限制输出开始位置和个数：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210102121129992.png" alt="image-20210102121129992" style="zoom:50%;" /></p>
<p>表示在符合条件的所有元素中，从第一个位置开始取，连续取2个元素。</p>
<h3 id="zrevrangebyscore">zrevrangebyscore</h3>
<p>语法：zrevrangebyscore key min max [WITHSCORES] [LIMIT offset
count]</p>
<p>作用：获取有序集key中，所有socre介于min和max之间(包括min和max)的成员，有序集合按递减(从大到小)排序</p>
<p>​ 使用符号<code>(</code>表示不包括min和max，也就是开区间；</p>
<p>​ 使用-inf和+inf分别表示，最小和最大；</p>
<p>​
<strong>LIMIT用来限制返回结果的数量和区间。表示在符合条件的成员中，从第offset个位置(索引从0开始)开始，取count个元素。</strong></p>
<p>​ WITHSCORES表示一起显示score和value</p>
<p>返回值：指定区间的集合数据</p>
<p>和zrangebyscore基本一样，这个是从大到小排序。</p>
<h3 id="zcount">zcount</h3>
<p>语法：zcount key min max</p>
<p>作用：返回有序集key中，score值在min和max之间(默认包括min和max)的成员数量。使用<code>(</code>代表开区间</p>
<p>返回值：元素个数</p>
<h3 id="zscore">zscore</h3>
<p>语法：zscore key member</p>
<p>作用：返回有序集key中，给定member的分数值score</p>
<p>返回值：分数值，不存在返回nil</p>
<h3 id="zrank">zrank</h3>
<p>语法：zrank key member</p>
<p>作用：返回有序集合key中指定成员索引，分数由小到大排列</p>
<p>返回值：索引值，不存在返回nil</p>
<h3 id="zrevrank">zrevrank</h3>
<p>语法：zrevrank key member</p>
<p>作用：返回有序集合key中指定成员索引，分数由大到小排列</p>
<p>返回值：索引值，不存在返回nil</p>
<h3 id="zremrangebyscore">zremrangebyscore</h3>
<p>语法：zremrangebyscore key start stop</p>
<p>作用：删除指定分数区间的所有元素，默认包括start和stop，使用<code>(</code>可不包括，开区间</p>
<p>返回值：成功删除的元素个数</p>
<h3 id="zremrangebyrank">zremrangebyrank</h3>
<p>语法：zremrangebyrank key start stop</p>
<p>作用：删除指定排名索引区间的所有元素，包括start和stop。索引从0开始，排序由小到大。</p>
<p>返回值：成功删除的元素个数</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Redis/3-%E5%85%B3%E4%BA%8Ekey%E7%9A%84%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Redis/3-%E5%85%B3%E4%BA%8Ekey%E7%9A%84%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">3-关于key的命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:22:39 / 修改时间：16:59:51" itemprop="dateCreated datePublished" datetime="2022-05-11T14:22:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Redis是key-value型数据库。所以有操作key的一类命令，同样也有操作value的一类命令。</p>
<h2 id="keys">keys</h2>
<p>语法：keys pattern</p>
<p>作用：查找所有符合模式pattern的key，pattern可以使用通配符。</p>
<p>通配符：</p>
<pre><code>        1. *：表示0-多个字符，keys *代表查询所有key
        2. ?：表示单个字符，例如keys hel?o，可匹配hello，helqo等</code></pre>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101131747885.png" alt="image-20210101131747885" style="zoom:80%;" /></p>
<h2 id="exists">exists</h2>
<p>语法：exists key [key..]</p>
<p>作用：判断指定的key或多个key是否存在。</p>
<p>返回值：返回存在key的数量，不管是查找一个key还是多个key</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101132026879.png" alt="image-20210101132026879" style="zoom:67%;" /></p>
<h2 id="expire">expire</h2>
<p>语法：expire key seconds</p>
<p>作用：设置key的生存时间，超过时间，key会自动删除，单位是秒</p>
<p>返回值：设置成功返回1，不成功是0</p>
<p>如果不设置，那么key会永久保存。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101132515408.png" alt="image-20210101132515408" style="zoom:67%;" /></p>
<h2 id="ttl">ttl</h2>
<p>语法 ：ttl key</p>
<p>作用：返回key的剩余时间(time to live)，以秒为单位</p>
<p>返回值：</p>
<ul>
<li>返回 -1：代表没有设置key的生存时间，永不过期</li>
<li>返回 -2 ：代表不存在该key</li>
<li>数字：key的剩余时间，秒为单位</li>
</ul>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101132827883.png" alt="image-20210101132827883" style="zoom:67%;" /></p>
<h2 id="type">type</h2>
<p>语法：type key</p>
<p>作用：查看key存储的value值得数据类型</p>
<p>返回值：使用字符串表示的数据类型</p>
<ul>
<li>none：key不存在</li>
<li>string：字符串</li>
<li>list：列表</li>
<li>set 集合</li>
<li>zset：有序集合</li>
<li>hash：哈希表</li>
</ul>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101133050493.png" alt="image-20210101133050493" style="zoom:67%;" /></p>
<h2 id="del">del</h2>
<p>语法：del key [key..]</p>
<p>作用：删除存在的key，不存在的key忽略</p>
<p>返回值：数字，删除的key的数量</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101133229831.png" alt="image-20210101133229831" style="zoom:67%;" /></p>
<h2 id="persist">persist</h2>
<p>语法：persist key</p>
<p>作用：移除key的过期时间，key将持久保持</p>
<p>返回值：成功返回1，失败返回0</p>
<h2 id="其他命令">其他命令</h2>
<ol type="1">
<li><p>randomkey</p>
<p>语法：randomkey</p>
<p>作用：从当前库随机返回一个key</p>
<p>返回值：返回一个key</p></li>
<li><p>move</p>
<p>语法：move key db</p>
<p>作用：将当前数据库中的指定key移动到数据库db中</p>
<p>返回值：成功返回1，失败返回0</p></li>
<li><p>pttl</p>
<p>语法：pttl key</p>
<p>作用：以毫秒为单位，返回key的剩余过期时间</p>
<p>返回值：</p>
<ul>
<li>-1：没有设置key的过期时间，永久保存</li>
<li>-2：不存在该key</li>
<li>数字：以毫秒为单位，key的剩余过期时间</li>
</ul></li>
<li><p>rename</p>
<p>语法：rename key newkey</p>
<p>作用：重命名key为newkey</p>
<p>返回OK代表成功</p>
<p>当库中已存在newkey时，那么newkey对应的值将被覆盖，也就是newkey对应的value将是key对应的value</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101134657570.png" alt="image-20210101134657570" style="zoom:67%;" /></p></li>
<li><p>renamenx</p>
<p>语法：rename key newkey</p>
<p>作用：当newkey不存在时，将key改名为newkey。也就是避免覆盖已存在的key对应的value</p></li>
<li><p>dump</p>
<p>语法：dump key</p>
<p>作用：序列为给定key</p>
<p>返回值：若序列化成功，则返回被序列化的值。</p></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Redis/2-Redis%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Redis/2-Redis%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">2-Redis基本操作命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:21:39 / 修改时间：16:59:49" itemprop="dateCreated datePublished" datetime="2022-05-11T14:21:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>首先运行服务器端Redis：</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101130538411.png" alt="image-20210101130538411" style="zoom: 50%;" /></p>
<h2 id="查看是否连接到服务器ping">查看是否连接到服务器：ping</h2>
<p>在客户端使用ping命令，可以查看客户端是否成功连接到服务端。如果成功连接到，会返回一个PONG</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101130645009.png" alt="image-20210101130645009" style="zoom:67%;" /></p>
<h2 id="切换库命令select-db">切换库命令：select db</h2>
<p>Redis默认创建16个库(该配置可以在配置文件中修改)，redis默认使用第一个库。</p>
<p>使用 <code>select
db</code>来切换其他库，db代表数据库编号，从0到15。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101130851545.png" alt="image-20210101130851545" style="zoom:80%;" /></p>
<h2 id="查看当前库中key的数目dbsize">查看当前库中key的数目：dbsize</h2>
<p>dbsize可以返回当前库中，key的数目。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101131011818.png" alt="image-20210101131011818" style="zoom:80%;" /></p>
<h2 id="删除当前库数据flushdb">删除当前库数据：flushdb</h2>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210101131115509.png" alt="image-20210101131115509" style="zoom:80%;" /></p>
<h2 id="退出exit或quit">退出：exit或quit</h2>
<p>注意，这个退出，只是指客户端退出，但是服务器端依然在运行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/Redis/1-Redis%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/Redis/1-Redis%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">1-Redis基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:20:39 / 修改时间：16:59:45" itemprop="dateCreated datePublished" datetime="2022-05-11T14:20:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/developing/redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="redis介绍">Redis介绍</h2>
<p>Redis是一个key-value存储系统，数据缓存在内存中，同时Redis会周期性的把更新的数据写入磁盘或修改操作写入追加的记录文件。</p>
<p>Redis支持主从同步，数据可以从主服务器上向任意数量的从服务器上同步。</p>
<p>Redis的value值支持5种数据类型，分别是字符串String，列表List、集合Set、有序集合zSet和哈希Hash。</p>
<h2 id="为啥使用redis">为啥使用Redis</h2>
<p>Redis是非关系型数据库，即NoSQL。在NoSQL数据库中数据之间是无联系的，没有关系，数据的结构是松散、可变的。</p>
<p>非关系型数据库的优势：</p>
<ul>
<li><p>大数据量，高性能</p>
<p>NoSQL数据库都具有非常高的读写性能，尤其是在大数据量下，表现很优秀。这得益于数据的无关系型，数据库结构简单。</p></li>
<li><p>灵活的数据模型</p>
<p>NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。</p></li>
<li><p>高可用</p></li>
<li><p>低成本</p></li>
</ul>
<p>当然，非关系型数据库也有劣势：</p>
<ul>
<li>数据之间没有关系</li>
<li>不支持标准的SQL，没有公认的NoSQL标准</li>
<li>没有关系型数据库的约束，大多数也没有索引概念</li>
<li>没有事务，不能依靠事务实现ACID</li>
<li>没有丰富的数据类型，如日期，数值，二进制等</li>
</ul>
<h2 id="redis简单使用">Redis简单使用</h2>
<p>Window版本的Redis不是真正的Redis，Reids的作者，是基于Linux系统，只写了Linux版本。Windows版本的Redis是微软公司推出的。但是和Linux版本的Redis使用基本相同。</p>
<p>在开发环境中，可以使用Windows，但在实际生产环境中，要使用Linux版本的。</p>
<h3 id="windows下使用">Windows下使用</h3>
<p>Redis有三个文件比较重要，redis-cli.exe、redis-server.exe和redis.window.conf，分别对应redis客户端，redis服务器端，redis的Windows版本配置文件。</p>
<p>在使用时，要先运行服务器端，然后运行客户端。</p>
<p>如果修改了配置文件，那么运行服务器时，要在./redis-server.exe 后加上
配置文件路径 redis.window.conf，让redis重新加载该配置文件。</p>
<p>Windows版本的Redis不支持后台启动。</p>
<p><strong>不要将Redis添加到Windows服务，会出错，很痛苦。</strong></p>
<h3 id="linux下使用">Linux下使用</h3>
<p>Linux和Windows文件一样。</p>
<p>Linux启动redis有两种方式：</p>
<ul>
<li>前台启动
./redis-server：启动后，该终端不能输入其他命令，也不能关闭，只能运行redis-sever</li>
<li>后台启动 ./redis-server &amp;：启动后，终端可以继续输入其他命令</li>
</ul>
<p>一般使用后台启动。</p>
<p>Linux关闭redis服务也有两种方式：</p>
<ul>
<li>在redis客户端使用shutdown命令关闭。这种关闭方式，redis会先执行完数据操作，再关闭服务器</li>
<li>直接使用kill命令杀死进程。不推荐这种方式，有可能会造成数据丢失</li>
</ul>
<h2 id="redis客户端">Redis客户端</h2>
<p>Redis客户端是一个程序，通过网络连接到Redis服务器，在客户端软件中使用Redis可以识别的命令，向Redis服务器发送命令。</p>
<p>就是和Redis服务器进行交互的工具。</p>
<p>redis-cli.exe是Redis自带的命令行客户端。</p>
<p>有两种连接reids服务器的方式</p>
<ul>
<li><p>直接运行redis-cli.exe，这时，默认使用ip 127.0.0.1
端口6379</p></li>
<li><p>运行redis-cli.exe，使用选项连接服务器，-h 主机 -p 端口，例如</p>
<p><code>./redis-cli -h 127.0.0.1 -p 6379</code></p></li>
</ul>
<p>连接远程Redis服务器，还需要修改服务器端配置文件，因为Redis有安全保护措施，默认只有本机才可以访问。</p>
<p>修改两个地方：</p>
<ul>
<li>bind ip ：用来绑定ip，即只有该ip才可以访问Redis。注释掉该行。</li>
<li>protected-mode yes：设置保护模式，改为no</li>
</ul>
<p>需要重新加载redis配置文件。</p>
<h2 id="redis日志">Redis日志</h2>
<p>在redis的配置文件中可以配置Redis的日志级别和日志输出路径</p>
<h3 id="loglevel">loglevel</h3>
<p>loglevel配置项用来配置输出日志级别，有四个级别：</p>
<ul>
<li>debug：会打印很多信息，适用于开发和测试阶段</li>
<li>verbose：比debug清爽一点</li>
<li>notice：适用于生产环境，<strong>默认值。</strong></li>
<li>warning：警告信息</li>
</ul>
<p>开发时，可以使用debug，在生产环境使用notice</p>
<h3 id="logfile">logfile</h3>
<p>logfile用来指定日志输出路径。</p>
<p>使用双引号来指定路径，例如<code>logfile
"D:/logs/redis.log"</code></p>
<p>如果注释掉该行，那么默认输出到控制台。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/SpringBoot/12-SpringBoot%E9%9B%86%E6%88%90logBack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/SpringBoot/12-SpringBoot%E9%9B%86%E6%88%90logBack/" class="post-title-link" itemprop="url">12-SpringBoot集成logBack</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:17:39 / 修改时间：17:01:22" itemprop="dateCreated datePublished" datetime="2022-05-11T14:17:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springboot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>SpringBoot官方推荐优先使用带有<code>-spring</code>的文件名作为日志配置(如使用logback-spring.xml)，默认放在src/main/resources目录下。如果不想用默认文件名格式和默认目录，可以通过配置文件的<code>logging.config</code>属性来指定自定义的名字。</p>
<p><code>logging-config=classpath:logging-config.xml</code>。</p>
<p>日志内容为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 日志级别从低到高分为 TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，</span></span><br><span class="line"><span class="comment">如果设置为 WARN，则低于 WARN 的信息都不会输出 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scan:当此属性设置为 true 时，配置文件如果发生改变，将会被重新加载，默认值为</span></span><br><span class="line"><span class="comment">true --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认</span></span><br><span class="line"><span class="comment">单位是毫秒。当 scan 为 true 时，此属性生效。默认的时间间隔为 1 分钟。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- de<span class="doctag">bug:</span>当此属性设置为 true 时，将打印出 logback 内部日志信息，实时查看 logback</span></span><br><span class="line"><span class="comment">运行状态。默认值为 false。通常不打印 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;100 seconds&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--输出到控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--此日志 appender 是为开发使用，只配置最底级别，控制台输出的日志级别是大</span></span><br><span class="line"><span class="comment">       于或等于此级别的日志信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            %date:时间，精确到毫秒,%d也可以</span></span><br><span class="line"><span class="comment">            %-5p:日志级别，-代表左对齐，5代表占位符有5个</span></span><br><span class="line"><span class="comment">            %thread:表示哪个线程输出的日志</span></span><br><span class="line"><span class="comment">            %logger(60):代表类路径，60表示最长字符串长度</span></span><br><span class="line"><span class="comment">            %file:表示文件名</span></span><br><span class="line"><span class="comment">            %line:行数</span></span><br><span class="line"><span class="comment">            %msg:表示日志信息</span></span><br><span class="line"><span class="comment">            %n:换行符</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d [%-5p] %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置字符集 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--输出到文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;File&gt;/home/log/stdout.log&lt;/File&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span>&gt;</span>D:/log/stdout.log<span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            %date:时间，精确到毫秒</span></span><br><span class="line"><span class="comment">            %-5p:日志级别，-代表左对齐，5代表占位符有5个</span></span><br><span class="line"><span class="comment">            %thread:表示哪个线程输出的日志</span></span><br><span class="line"><span class="comment">            %logger(60):代表类路径，60表示最长字符串长度</span></span><br><span class="line"><span class="comment">            %file:表示文件名</span></span><br><span class="line"><span class="comment">            %line:行数</span></span><br><span class="line"><span class="comment">            %msg:表示日志信息</span></span><br><span class="line"><span class="comment">            %n:换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date [%-5p] [%thread] %logger&#123;60&#125;</span><br><span class="line">                [%file : %line] %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 添加.gz 历史日志会启用压缩 大大缩小日志文件所占空间 --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--&lt;fileNamePattern&gt;/home/log/stdout.log.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNam</span></span><br><span class="line"><span class="comment">            ePattern&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>D:/log/stdout.log.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span><span class="comment">&lt;!-- 保留 30 天日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--单个设置，设置数据持久层的level--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.abc.springboot.mapper&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--使用root标签引用，才能生效。全局设置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果要自己打印日志。需要引入lombok依赖，在需要打印的类上加注解<code>@Slf4j</code>。</p>
<p>然后使用该依赖的<code>log</code>来打印不同级别的日志。</p>
<p><img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210127151636088.png" alt="image-20210127151636088" style="zoom:67%;" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/SpringBoot/11-Thymeleaf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/SpringBoot/11-Thymeleaf/" class="post-title-link" itemprop="url">11-Thymeleaf</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:16:39 / 修改时间：17:01:20" itemprop="dateCreated datePublished" datetime="2022-05-11T14:16:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springboot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简单介绍">简单介绍</h2>
<p>Thymeleaf是一个模板引擎，采用Java开发。</p>
<p>Thymeleaf对网络环境要求不严格，既能用于Web环境，也能用于非Web环境。在非Web环境(即不开启服务器，只打开该文件)下，可以直接显示模板的静态数据；在Web环境下，可以像JSP一样从后台接受数据，并替换掉模板的静态数据，它是基于HTML的，以HTML为载体，Thymeleaf要寄托在HTML标签下才可以实现。</p>
<p>SpringBoot集成了Thymeleaf技术，SpringBoot官方也推荐使用Thymeleaf来代替JSP技术。但它本身并不属于SpringBoot。</p>
<p>该模板文件可以直接在任何浏览器内正确显示，浏览器会自动忽略不能理解的属性。但是这并不是一个真正有效的HTML5文档，因为HTML5文档没有<code>th:*</code>这些非标准属性的。需要Thymeleaf解析后才会变成一个标准的HTML文档。</p>
<h2 id="thymeleaf的简单使用">Thymeleaf的简单使用</h2>
<p>首先要加入Thymeleaf的起步依赖，可以在创建SpringBoot项目时就直接添加该依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后创建html文件，并且需要在文件中添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>即html文件变成：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>并且默认将该模板文件放在resources/templates目录中，将其他静态资源文件如js，css，图片等放在resources/static目录中。</p>
<h2 id="thymeleaf基础语法">Thymeleaf基础语法</h2>
<p>所有有关Thymeleaf的属性开头都是<code>th:*</code>，<code>*</code>代表任意属性。有些浏览器不支持该写法。也可以使用<code>data-th-*</code>来代替<code>th:*</code>语法。</p>
<h3 id="显示文本">显示文本</h3>
<p>使用<code>th:text</code>和<code>th:utext</code>来显示数据。</p>
<p>两者不同是：</p>
<p><code>th:text</code>属性不解析html元素，传来什么数据就显示什么数据。</p>
<code>th:utext</code>属性将解析HTML元素。如传来的数据是<code>&lt;p&gt;一个段落&lt;/p&gt;</code>，那么该属性会识别到
<p>
<p>是一个html标签，进行解析。</p>
<h3 id="简单表达式">简单表达式</h3>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 17%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="header">
<th>语法</th>
<th>描述</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>$&#123;..&#125;</code></td>
<td>变量表达式</td>
<td>取出上下文变量的值</td>
</tr>
<tr class="even">
<td><code>*&#123;..&#125;</code></td>
<td>选择变量表达式</td>
<td>取出选择的对象的属性值</td>
</tr>
<tr class="odd">
<td><code>#&#123;..&#125;</code></td>
<td>消息表达式</td>
<td>能够从外部源(.properties文件)获得属性值，一般用于国际化消息</td>
</tr>
<tr class="even">
<td><code>@&#123;..&#125;</code></td>
<td>链接表达式</td>
<td>用于表示各种超链接地址</td>
</tr>
<tr class="odd">
<td><code>~&#123;..&#125;</code></td>
<td>片段表达式</td>
<td>引用一段公共的代码片段</td>
</tr>
</tbody>
</table>
<h4 id="变量表达式">变量表达式</h4>
<p>语法：${变量名}</p>
<p>说明：标准变量表达式用于访问容器上下文环境的变量。Thymeleaf使用变量表达式来获取Controller传过来的Model中的数据。</p>
<p>可以是简单变量String，Integer，这时候直接使用变量名即可。</p>
<p>也可以是引用变量，这时候要使用${变量名.属性名}的方式。</p>
<p><code>$&#123;..&#125;</code>的作用域是面向整个上下文。</p>
<p>一个例子：</p>
<p>控制器方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/thymeleaf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getIndex</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(<span class="number">1</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    user.setAddress(<span class="string">&quot;河北省石家庄市&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;测试Thymeleaf成功&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>html文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Thymeleaf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;data&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    用户的ID是:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    用户的姓名是:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    用户的地址是:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.address&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果：
<img src="https://crayon-1302863897.cos.ap-beijing.myqcloud.com/image/image-20210123193016754.png" alt="image-20210123193016754" style="zoom:50%;" /></p>
<h4 id="选择变量表达式">选择变量表达式</h4>
<p>不推荐使用。</p>
<p>语法：*{...}</p>
<p>说明：也叫星号变量表达式。使用<code>th:object</code>属性来绑定对象。</p>
<p>然后使用<code>*</code>来代表这个对象，<code>*</code>后面的<code>&#123;&#125;</code>中的值时此对象的属性。</p>
<p>选择变量表达式<code>*&#123;..&#125;</code>类似于标准变量表达式<code>$&#123;..&#125;</code>表示变量的写法。</p>
<p>选择变量表达式是在执行时在选择的对象上求解，而标准变量表达式是在上下文的Model上求解。</p>
<p>这种写法比较繁琐，不推荐使用。</p>
<p>选择变量表达式<code>*&#123;..&#125;</code>的作用域是父标签<code>th:object</code>。</p>
<p>例子：</p>
<p>控制器方法不用改，html文件改为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Thymeleaf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;data&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">        用户ID:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        用户姓名:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        用户地址:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;getAddress()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以不使用<code>th:object</code>绑定对象，直接使用<code>*&#123;变量名.属性名&#125;</code>，和<code>$&#123;&#125;</code>用法一样。</p>
<h4 id="消息表达式">消息表达式</h4>
<p>消息表达式<code>#&#123;..&#125;</code>用于国际化文字信息，也就是根据语言改变显示文字，<code>.properteis</code>文件命名规则一般是：</p>
<ul>
<li><code>basename.properties</code></li>
<li><code>basename_language.properties</code></li>
<li><code>basename_language_country.properties</code></li>
</ul>
<p>其中：basename是自定义的资源文件名称，language和country是Java支持的语言和国家。如中国中文是<code>messages_zn_CN.properties</code>。</p>
<p><code>basename.properties</code>是缺省加载的资源文件，当客户端根据本地语言查找不到相关资源文件，则使用该配置文件。</p>
<p>资源文件应该放在resources目录中。</p>
<p>SpringBoot加载资源文件的默认名称是messages。并且默认放在resources目录中。如果放在其他目录或者名称不是messages，那么在<code>application.properties</code>中修改<code>spring.messages.basename</code>属性来修改。如放在resources/i18n目录中，basename是message，那么属性应变为<code>spring.messages.basebame=i18n/message</code>。</p>
<h5 id="一个例子">一个例子</h5>
<p>创建一个资源文件文件名为<code>messages_zn_CH.properties</code>：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">welcome.message</span>=<span class="string">欢迎你!</span></span><br></pre></td></tr></table></figure>
<p>在html文件中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;welcome.message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就可以调用到属性值。</p>
<h5 id="使用占位符">使用占位符</h5>
<p>消息表达式<code>#&#123;..&#125;</code>不允许直接处理静态文本消息，例如调用变量。但是可以在资源文件中使用占位符<code>&#123;&#125;</code>来处理费静态文本消息：</p>
<p>资源文件配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">welcome.message</span>=<span class="string">&#123;0&#125;, 欢迎你!</span></span><br><span class="line"><span class="attr">encoding</span>=<span class="string">&#123;0&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后在html中以参数形式传递变量：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;welcome.message(&#x27;Jack&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">字符编码是:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;encoding($&#123;#request.getCharacterEncoding()&#125;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果一个属性中有多个占位符，如<code>encoding=&#123;0&#125;   &#123;1&#125;</code>，那么在参数传递时，使用逗号<code>,</code>来分割不同参数。</p>
<p>即：`&lt;span th:text="#{encoding('字符编码是:',$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/SpringBoot/10-SpringBoot%E8%AE%BE%E7%BD%AE%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/SpringBoot/10-SpringBoot%E8%AE%BE%E7%BD%AE%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" class="post-title-link" itemprop="url">10-SpringBoot设置字符编码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:15:39 / 修改时间：17:01:16" itemprop="dateCreated datePublished" datetime="2022-05-11T14:15:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springboot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>配置字符编码有两种方式，一种是在application.properties中设置，另一种就是用传统的字符编码过滤器。</p>
<p>推荐使用第一种方式，这里也只介绍第一种方式。</p>
<p>非常简单，在application.properties设置三个属性即可。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置请求响应的字符编码</span></span><br><span class="line"><span class="attr">server.servlet.encoding.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">server.servlet.encoding.force</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">server.servlet.encoding.charset</span>=<span class="string">UTF-8</span></span><br></pre></td></tr></table></figure>
<p>第一个属性作用是启用编码。</p>
<p>第二个属性作用是强制使用设置的编码。</p>
<p>第三个属性指定要使用的字符集。</p>
<p>设置这三个属性就可以了。</p>
<p>在之前版本使用的是<code>server.http...</code>，这个属性被弃用了，使用现在这个<code>server.servlet</code>.就可以。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhaoquaner.github.io/2022/05/11/SpringBoot/9-SpringBoot%E4%BD%BF%E7%94%A8Servlet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhaoXin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 赵圈儿的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/SpringBoot/9-SpringBoot%E4%BD%BF%E7%94%A8Servlet/" class="post-title-link" itemprop="url">9-SpringBoot使用Servlet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 14:14:39 / 修改时间：17:01:14" itemprop="dateCreated datePublished" datetime="2022-05-11T14:14:39+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programming/springboot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在SpringBoot中有两种方法可以直接使用Servlet。当然一般都直接使用控制器类。</p>
<h2 id="注解">注解</h2>
<p>使用注解<strong><span class="citation"
data-cites="WebServlet">@WebServlet</span></strong>来标识该类是一个Servlet类可以被SpringBoot扫描到。</p>
<p>该注解有一个属性urlPatterns来表示该Servlet处理哪个或者哪些请求。</p>
<p>然后在主类Application上加上注解<strong><span class="citation"
data-cites="ServletComponentScan">@ServletComponentScan</span>("包路径")</strong>，使用SpringBoot能够扫描到该Servlet。</p>
<p>例子： 创建一个Servlet类，继承HttpServlet。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/springboot/sayHello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">5556813722982445881L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        pw.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        pw.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在主类上加上注解<strong><span class="citation"
data-cites="ServletComponentScan">@ServletComponentScan</span>("包路径")</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ServletComponentScan(basePackages = &quot;com.example.demo.controller&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就可以了。</p>
<h2 id="配置类">配置类</h2>
<p>第二种方式是使用配置类。</p>
<p>首先创建一个关于注册Servlet的配置类。并在该类上加上注解@Configuration</p>
<p>并创建一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">httpServletRegistrationBean</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">servletRegistrationBean</span></span><br><span class="line">                <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(),<span class="string">&quot;/springboot/sayHello&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>在方法上加上注解@Bean。该注解表示将该方法交给Spring容器管理。即该方法会产生一个对象，Spring容器将管理该对象。</strong></p>
<p><strong><span class="citation"
data-cites="Bean注解只能在">@Bean注解只能在</span><span class="citation"
data-cites="Configuration注解下使用">@Configuration注解下使用</span>。</strong></p>
<p><strong>SerlvetRegistrationBean表示一个Servlet注册类对象。</strong></p>
<p><strong>在该方法中创建该对象，并将Servlet对象和该Servlet对象要处理的请求url作为参数。最后返回该对象。</strong></p>
<p>当然直接使用Servlet很少用，一般直接用控制器。</p>
<p>​</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhaoXin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
